{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 66,
   "id": "80ffac68-cedc-4993-98e3-a09398fdaf45",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: pandas in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (2.3.3)\n",
      "Requirement already satisfied: numpy in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (2.3.4)\n",
      "Requirement already satisfied: matplotlib in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (3.10.7)\n",
      "Requirement already satisfied: seaborn in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (0.13.2)\n",
      "Requirement already satisfied: plotly in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (6.5.2)\n",
      "Requirement already satisfied: scipy in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (1.16.3)\n",
      "Requirement already satisfied: scikit-learn in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (1.8.0)\n",
      "Requirement already satisfied: python-dateutil>=2.8.2 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from pandas) (2.9.0.post0)\n",
      "Requirement already satisfied: pytz>=2020.1 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from pandas) (2025.2)\n",
      "Requirement already satisfied: tzdata>=2022.7 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from pandas) (2025.3)\n",
      "Requirement already satisfied: contourpy>=1.0.1 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from matplotlib) (1.3.3)\n",
      "Requirement already satisfied: cycler>=0.10 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from matplotlib) (0.12.1)\n",
      "Requirement already satisfied: fonttools>=4.22.0 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from matplotlib) (4.60.1)\n",
      "Requirement already satisfied: kiwisolver>=1.3.1 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from matplotlib) (1.4.9)\n",
      "Requirement already satisfied: packaging>=20.0 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from matplotlib) (25.0)\n",
      "Requirement already satisfied: pillow>=8 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from matplotlib) (12.0.0)\n",
      "Requirement already satisfied: pyparsing>=3 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from matplotlib) (3.2.5)\n",
      "Requirement already satisfied: narwhals>=1.15.1 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from plotly) (2.15.0)\n",
      "Requirement already satisfied: joblib>=1.3.0 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from scikit-learn) (1.5.3)\n",
      "Requirement already satisfied: threadpoolctl>=3.2.0 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from scikit-learn) (3.6.0)\n",
      "Requirement already satisfied: six>=1.5 in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from python-dateutil>=2.8.2->pandas) (1.17.0)\n",
      "âœ… å¥—ä»¶è¼‰å…¥å®Œæˆ\n",
      "ğŸ“ ç•¶å‰å·¥ä½œç›®éŒ„: c:\\Users\\user\\Desktop\\workspace - è¤‡è£½\\orkspace\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n",
      "[notice] A new release of pip is available: 25.0.1 -> 26.0\n",
      "[notice] To update, run: python.exe -m pip install --upgrade pip\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 1: å®‰è£èˆ‡å°å…¥å¥—ä»¶ =====\n",
    "# å¦‚æœç¼ºå°‘å¥—ä»¶ï¼Œè«‹å…ˆåŸ·è¡Œï¼š\n",
    "!pip install pandas numpy matplotlib seaborn plotly scipy scikit-learn\n",
    "\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "import plotly.graph_objects as go\n",
    "import plotly.express as px\n",
    "from plotly.subplots import make_subplots\n",
    "import os\n",
    "import glob\n",
    "import warnings\n",
    "from pathlib import Path\n",
    "from datetime import datetime\n",
    "from scipy import stats\n",
    "import json\n",
    "\n",
    "warnings.filterwarnings('ignore')\n",
    "\n",
    "# è¨­å®šä¸­æ–‡å­—é«”ï¼ˆMac/Linuxï¼‰\n",
    "# plt.rcParams['font.sans-serif'] = ['Arial Unicode MS', 'DejaVu Sans']\n",
    "# Windows ç”¨æˆ¶æ”¹ç”¨ï¼š\n",
    "plt.rcParams['font.sans-serif'] = ['Microsoft JhengHei']\n",
    "plt.rcParams['axes.unicode_minus'] = False\n",
    "\n",
    "# è¨­å®šè¦–è¦ºåŒ–é¢¨æ ¼\n",
    "sns.set_style(\"whitegrid\")\n",
    "plt.rcParams['figure.figsize'] = (12, 6)\n",
    "plt.rcParams['figure.dpi'] = 100\n",
    "\n",
    "print(\"âœ… å¥—ä»¶è¼‰å…¥å®Œæˆ\")\n",
    "print(f\"ğŸ“ ç•¶å‰å·¥ä½œç›®éŒ„: {os.getcwd()}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 67,
   "id": "ecbbc787-6a67-4114-b1e5-6f63aadb4562",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "âœ… è³‡æ–™å¤¾çµæ§‹å»ºç«‹å®Œæˆï¼š\n",
      "   ğŸ“ data/raw\n",
      "   ğŸ“ data/processed\n",
      "   ğŸ“ reports/figures/raw_timeseries\n",
      "   ğŸ“ reports/figures/delta_timeseries\n",
      "   ğŸ“ reports/figures/arduino_features\n",
      "   ğŸ“ reports/figures/distributions\n",
      "   ğŸ“ reports/figures/stability\n",
      "   ğŸ“ reports/figures/correlation\n",
      "   ğŸ“ reports/figures/sensor_health\n",
      "   ğŸ“ reports/summary\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 2: å»ºç«‹å°ˆæ¡ˆè³‡æ–™å¤¾çµæ§‹ =====\n",
    "\n",
    "def create_project_structure():\n",
    "    \"\"\"å»ºç«‹å°ˆæ¡ˆæ‰€éœ€çš„è³‡æ–™å¤¾çµæ§‹\"\"\"\n",
    "    folders = [\n",
    "        'data/raw',\n",
    "        'data/processed',\n",
    "        'reports/figures/raw_timeseries',\n",
    "        'reports/figures/delta_timeseries',\n",
    "        'reports/figures/arduino_features',  # ğŸ‘ˆ æ–°å¢ï¼šArduino ç‰¹å¾µè¦–è¦ºåŒ–\n",
    "        'reports/figures/distributions',\n",
    "        'reports/figures/stability',\n",
    "        'reports/figures/correlation',\n",
    "        'reports/figures/sensor_health',     # ğŸ‘ˆ æ–°å¢ï¼šæ„Ÿæ¸¬å™¨å¥åº·åº¦\n",
    "        'reports/summary'\n",
    "    ]\n",
    "    \n",
    "    for folder in folders:\n",
    "        Path(folder).mkdir(parents=True, exist_ok=True)\n",
    "    \n",
    "    print(\"âœ… è³‡æ–™å¤¾çµæ§‹å»ºç«‹å®Œæˆï¼š\")\n",
    "    for folder in folders:\n",
    "        print(f\"   ğŸ“ {folder}\")\n",
    "\n",
    "create_project_structure()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 68,
   "id": "2d839d05-ce19-4245-bb37-e1456779e10e",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: openpyxl in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (3.1.5)\n",
      "Requirement already satisfied: et-xmlfile in c:\\users\\user\\appdata\\local\\programs\\python\\python313\\lib\\site-packages (from openpyxl) (2.0.0)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n",
      "[notice] A new release of pip is available: 25.0.1 -> 26.0\n",
      "[notice] To update, run: python.exe -m pip install --upgrade pip\n"
     ]
    }
   ],
   "source": [
    "!pip install openpyxl"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 69,
   "id": "d1d9df2c-ca22-4b20-a5ce-e2baab74d597",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "ğŸ“‹ å¯¦éš›çš„æ¬„ä½åç¨±ï¼š\n",
      "['# ### MODE: PINEAPPLE_INTERNAL_ADC ###', 'Unnamed: 1', 'Unnamed: 2', 'Unnamed: 3', 'Unnamed: 4', 'Unnamed: 5', 'Unnamed: 6', 'Unnamed: 7', 'Unnamed: 8', 'Unnamed: 9', 'Unnamed: 10', 'Unnamed: 11', 'Unnamed: 12', 'Unnamed: 13', 'Unnamed: 14', 'Unnamed: 15', 'Unnamed: 16', 'Unnamed: 17', 'Unnamed: 18', 'Unnamed: 19', 'Unnamed: 20', 'Unnamed: 21', 'Unnamed: 22', 'Unnamed: 23', 'Unnamed: 24']\n"
     ]
    }
   ],
   "source": [
    "# æ¸¬è©¦è®€å–ä¸€å€‹æª”æ¡ˆï¼Œçœ‹çœ‹çœŸæ­£çš„æ¬„ä½åç¨±\n",
    "import pandas as pd\n",
    "import glob\n",
    "import os\n",
    "\n",
    "# éš¨ä¾¿è®€ä¸€å€‹æª”æ¡ˆ\n",
    "test_file = glob.glob('data/raw/*.xlsx')[0]\n",
    "df_test = pd.read_excel(test_file)\n",
    "\n",
    "print(\"ğŸ“‹ å¯¦éš›çš„æ¬„ä½åç¨±ï¼š\")\n",
    "print(df_test.columns.tolist())\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 70,
   "id": "5721435b-2aaa-4632-87a6-4b8b04d73907",
   "metadata": {},
   "outputs": [],
   "source": [
    "#ç™¼ç¾ç¬¬ä¸€è¡Œæ˜¯è¨»è§£ï¼Œæ‰€ä»¥è¦å¯«è·³é"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 71,
   "id": "7c099ae8-fead-40bb-ab02-086f0454f6fb",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "ğŸ” æ‰¾åˆ° 41 å€‹ Excel æª”æ¡ˆ\n",
      "   âœ“ Pineapple: pineapple_01_20250201.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_01_20250201_air.xlsx (912 rows) -> key=01_20250201\n",
      "   âœ“ Pineapple: pineapple_01_20250202.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_01_20250202_air.xlsx (912 rows) -> key=01_20250202\n",
      "   âœ“ Pineapple: pineapple_01_20250203.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_01_20250203_air.xlsx (912 rows) -> key=01_20250203\n",
      "   âœ“ Pineapple: pineapple_01_20250204.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_01_20250204_air.xlsx (912 rows) -> key=01_20250204\n",
      "   âœ“ Pineapple: pineapple_01_20250205.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_01_20250205_air.xlsx (912 rows) -> key=01_20250205\n",
      "   âœ“ Pineapple: pineapple_02_20250202.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_02_20250202_air.xlsx (912 rows) -> key=02_20250202\n",
      "   âœ“ Pineapple: pineapple_02_20250203.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_02_20250203_air.xlsx (912 rows) -> key=02_20250203\n",
      "   âœ“ Pineapple: pineapple_02_20250204.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_02_20250204_air.xlsx (912 rows) -> key=02_20250204\n",
      "   âœ“ Pineapple: pineapple_02_20250205.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_02_20250205_air.xlsx (912 rows) -> key=02_20250205\n",
      "   âœ“ Pineapple: pineapple_03_20250203.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_03_20250203_air.xlsx (912 rows) -> key=03_20250203\n",
      "   âœ“ Pineapple: pineapple_03_20250204.xlsx (913 rows)\n",
      "   âœ“ Air: pineapple_03_20250204_air.xlsx (913 rows) -> key=03_20250204\n",
      "   âœ“ Pineapple: pineapple_03_20250205.xlsx (913 rows)\n",
      "   âœ“ Air: pineapple_03_20250205_air.xlsx (913 rows) -> key=03_20250205\n",
      "   âœ“ Pineapple: pineapple_04_20250203.xlsx (912 rows)\n",
      "   âœ“ Air: pineapple_04_20250203_air.xlsx (912 rows) -> key=04_20250203\n",
      "   âœ“ Pineapple: pineapple_04_20250204.xlsx (913 rows)\n",
      "   âœ“ Air: pineapple_04_20250204_air.xlsx (913 rows) -> key=04_20250204\n",
      "   âœ“ Pineapple: pineapple_04_20250205.xlsx (913 rows)\n",
      "   âœ“ Air: pineapple_04_20250205_air.xlsx (913 rows) -> key=04_20250205\n",
      "   âœ“ Pineapple: pineapple_05_20250202.xlsx (911 rows)\n",
      "   âœ“ Air: pineapple_05_20250202_air.xlsx (911 rows) -> key=05_20250202\n",
      "   âœ“ Pineapple: pineapple_05_20250203.xlsx (911 rows)\n",
      "   âœ“ Air: pineapple_05_20250203_air.xlsx (911 rows) -> key=05_20250203\n",
      "   âœ“ Pineapple: pineapple_05_20250204.xlsx (911 rows)\n",
      "   âœ“ Air: pineapple_05_20250204_air.xlsx (911 rows) -> key=05_20250204\n",
      "   âœ“ Pineapple: pineapple_06_20250202.xlsx (911 rows)\n",
      "   âœ“ Pineapple: pineapple_06_20250203.xlsx (911 rows)\n",
      "   âœ“ Air: pineapple_06_20250203_air.xlsx (911 rows) -> key=06_20250203\n",
      "   âœ“ Pineapple: pineapple_06_20250204.xlsx (915 rows)\n",
      "   âœ“ Air: pineapple_06_20250204_air.xlsx (911 rows) -> key=06_20250204\n",
      "\n",
      "âœ… è¼‰å…¥å®Œæˆ:\n",
      "   ğŸŒ¬ï¸  Air baseline æª”æ¡ˆæ•¸: 20\n",
      "   ğŸ Pineapple: 6 é¡†\n",
      "\n",
      "ğŸ“Š è¼‰å…¥è©³æƒ…:\n",
      "Air baseline keys: ['01_20250201', '01_20250202', '01_20250203', '01_20250204', '01_20250205', '02_20250202', '02_20250203', '02_20250204', '02_20250205', '03_20250203', '03_20250204', '03_20250205', '04_20250203', '04_20250204', '04_20250205', '05_20250202', '05_20250203', '05_20250204', '06_20250203', '06_20250204']\n",
      "Pineapple IDs: ['01', '02', '03', '04', '05', '06']\n",
      "  ğŸ 01: ['20250201', '20250202', '20250203', '20250204', '20250205']\n",
      "  ğŸ 02: ['20250202', '20250203', '20250204', '20250205']\n",
      "  ğŸ 03: ['20250203', '20250204', '20250205']\n",
      "  ğŸ 04: ['20250203', '20250204', '20250205']\n",
      "  ğŸ 05: ['20250202', '20250203', '20250204']\n",
      "  ğŸ 06: ['20250202', '20250203', '20250204']\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 3: è³‡æ–™è¼‰å…¥å™¨ (Excel ç‰ˆæœ¬) - è‡ªå‹•åµæ¸¬æ ¼å¼ =====\n",
    "\n",
    "import pandas as pd\n",
    "import glob\n",
    "import os\n",
    "\n",
    "class PineappleDataLoader:\n",
    "    \"\"\"æ‰¹æ¬¡è¼‰å…¥èˆ‡è§£æé³³æ¢¨æ„Ÿæ¸¬å™¨æ•¸æ“š (Excel æ ¼å¼)\"\"\"\n",
    "    \n",
    "    def __init__(self, data_dir='data/raw'):\n",
    "        self.data_dir = data_dir\n",
    "        # air_dataï¼škey = \"é³³æ¢¨ç·¨è™Ÿ_æ—¥æœŸ\"ï¼ˆä¾‹å¦‚ 01_20250205ï¼‰ï¼Œvalue = DataFrame\n",
    "        self.air_data = {}      \n",
    "        # pineapple_dataï¼š{pineapple_id: {date: DataFrame}}\n",
    "        self.pineapple_data = {}\n",
    "        \n",
    "    def load_all_data(self):\n",
    "        \"\"\"è‡ªå‹•è¼‰å…¥æ‰€æœ‰ Excel æª”æ¡ˆ\"\"\"\n",
    "        xlsx_files = glob.glob(os.path.join(self.data_dir, '*.xlsx'))\n",
    "        \n",
    "        if not xlsx_files:\n",
    "            print(f\"âŒ åœ¨ {self.data_dir} æ‰¾ä¸åˆ° Excel æª”æ¡ˆ\")\n",
    "            return\n",
    "        \n",
    "        print(f\"ğŸ” æ‰¾åˆ° {len(xlsx_files)} å€‹ Excel æª”æ¡ˆ\")\n",
    "        \n",
    "        for file_path in xlsx_files:\n",
    "            filename = os.path.basename(file_path)\n",
    "            self._parse_and_load(file_path, filename)\n",
    "        \n",
    "        print(f\"\\nâœ… è¼‰å…¥å®Œæˆ:\")\n",
    "        print(f\"   ğŸŒ¬ï¸  Air baseline æª”æ¡ˆæ•¸: {len(self.air_data)}\")\n",
    "        print(f\"   ğŸ Pineapple: {len(self.pineapple_data)} é¡†\")\n",
    "        \n",
    "        return self.air_data, self.pineapple_data\n",
    "    \n",
    "    def _parse_and_load(self, file_path, filename):\n",
    "        \"\"\"è§£æå–®ä¸€æª”æ¡ˆ\n",
    "        \n",
    "        å‘½åè¦å‰‡ï¼š\n",
    "        - air: pineapple_01_20250205_air.xlsx\n",
    "        - é³³æ¢¨: pineapple_01_20250205.xlsx\n",
    "        å…¶ä¸­ 01 ç‚ºé³³æ¢¨ç·¨è™Ÿï¼Œ20250205 ç‚ºæ—¥æœŸ\n",
    "        \"\"\"\n",
    "        try:\n",
    "            parts = filename.replace('.xlsx', '').split('_')\n",
    "            \n",
    "            if len(parts) < 3:\n",
    "                print(f\"âš ï¸  è·³éä¸ç¬¦åˆå‘½åè¦å‰‡çš„æª”æ¡ˆ: {filename}\")\n",
    "                return\n",
    "            \n",
    "            pineapple_id = parts[1]   # '01'\n",
    "            date = parts[2]           # '20250205'\n",
    "            is_air = 'air' in filename\n",
    "            \n",
    "            # è®€å– Excel\n",
    "            df = self._read_excel_with_validation(file_path, filename)\n",
    "            \n",
    "            if df is None:\n",
    "                return\n",
    "            \n",
    "            if is_air:\n",
    "                # å°æ‡‰å‘½åè¦å‰‡ï¼šä¸åŒæ—¥æœŸçš„ air æœƒæœ‰ä¸åŒ key\n",
    "                air_key = f\"{pineapple_id}_{date}\"\n",
    "                self.air_data[air_key] = df\n",
    "                print(f\"   âœ“ Air: {filename} ({len(df)} rows) -> key={air_key}\")\n",
    "            else:\n",
    "                if pineapple_id not in self.pineapple_data:\n",
    "                    self.pineapple_data[pineapple_id] = {}\n",
    "                self.pineapple_data[pineapple_id][date] = df\n",
    "                print(f\"   âœ“ Pineapple: {filename} ({len(df)} rows)\")\n",
    "                \n",
    "        except Exception as e:\n",
    "            print(f\"âŒ è¼‰å…¥å¤±æ•— {filename}: {e}\")\n",
    "    \n",
    "    def _read_excel_with_validation(self, file_path, filename):\n",
    "        \"\"\"\n",
    "        è®€å–ä¸¦é©—è­‰ Excel æ ¼å¼\n",
    "        è‡ªå‹•åµæ¸¬ï¼š\n",
    "        1. ç¬¬ 1 åˆ—å°±æ˜¯æ¬„ä½åç¨±ï¼ˆæ–°æ ¼å¼ï¼‰\n",
    "        2. ç¬¬ 1 åˆ—æ˜¯è¨»è§£ï¼Œç¬¬ 2 åˆ—æ‰æ˜¯æ¬„ä½åç¨±ï¼ˆèˆŠæ ¼å¼ï¼‰\n",
    "        \"\"\"\n",
    "        required_cols = [\n",
    "            'timestamp_ms', 'MQ2_raw', 'MQ3_raw', 'MQ9_raw',\n",
    "            'MQ135_raw', 'TGS2602_raw', 'Temp_C', 'Humidity_pct', 'Pressure_hPa'\n",
    "        ]\n",
    "\n",
    "        try:\n",
    "            # â‘  å…ˆè©¦ï¼šç¬¬ä¸€åˆ—å°±æ˜¯æ¬„ä½åç¨±ï¼ˆæ–°æ ¼å¼ï¼‰\n",
    "            df = pd.read_excel(file_path, engine='openpyxl')\n",
    "            \n",
    "            # æª¢æŸ¥ç¬¬ä¸€åˆ—æ˜¯ä¸æ˜¯è¨»è§£\n",
    "            first_col_name = str(df.columns[0])\n",
    "            \n",
    "            if first_col_name.startswith('#') or 'MODE' in first_col_name or 'Unnamed' in first_col_name:\n",
    "                # ç¬¬ä¸€åˆ—æ˜¯è¨»è§£ï¼Œè·³éé‡è®€\n",
    "                df = pd.read_excel(file_path, engine='openpyxl', skiprows=1)\n",
    "            \n",
    "            # é©—è­‰æ¬„ä½\n",
    "            missing_cols = [col for col in required_cols if col not in df.columns]\n",
    "            \n",
    "            if missing_cols:\n",
    "                print(f\"âš ï¸  {filename} ç¼ºå°‘æ¬„ä½: {missing_cols}\")\n",
    "                print(f\"      å¯¦éš›æ¬„ä½å‰ 5 å€‹: {df.columns.tolist()[:5]}\")\n",
    "                return None\n",
    "            \n",
    "            # å¼·åˆ¶è½‰æ›è³‡æ–™å‹åˆ¥ï¼ˆé¿å…å­—ä¸²å•é¡Œï¼‰\n",
    "            numeric_cols = ['timestamp_ms', 'MQ2_raw', 'MQ3_raw', 'MQ9_raw', \n",
    "                           'MQ135_raw', 'TGS2602_raw', 'Temp_C', 'Humidity_pct', 'Pressure_hPa']\n",
    "            \n",
    "            for col in numeric_cols:\n",
    "                if col in df.columns:\n",
    "                    df[col] = pd.to_numeric(df[col], errors='coerce')  # è½‰æ›æˆæ•¸å­—ï¼Œç„¡æ³•è½‰çš„è®Š NaN\n",
    "            \n",
    "            return df\n",
    "\n",
    "        except Exception as e:\n",
    "            print(f\"âŒ è®€å–éŒ¯èª¤ {filename}: {e}\")\n",
    "            return None\n",
    "\n",
    "# æ¸¬è©¦è¼‰å…¥\n",
    "loader = PineappleDataLoader('data/raw')\n",
    "air_data, pineapple_data = loader.load_all_data()\n",
    "\n",
    "# é¡¯ç¤ºè¼‰å…¥è©³æƒ…\n",
    "print(\"\\nğŸ“Š è¼‰å…¥è©³æƒ…:\")\n",
    "print(f\"Air baseline keys: {list(air_data.keys())}\")\n",
    "print(f\"Pineapple IDs: {list(pineapple_data.keys())}\")\n",
    "for pid, dates in pineapple_data.items():\n",
    "    print(f\"  ğŸ {pid}: {list(dates.keys())}\")\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 72,
   "id": "46c5ba5b-bb14-436c-ae26-9657d5b83839",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\n",
      "ğŸ§¹ é–‹å§‹æ‰¹æ¬¡æ¸…æ´—æ•¸æ“š\n",
      "==================================================\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_01_20250201...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=1.64%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=1.44%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=1.87%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=2.02%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.39%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_01_20250202...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=3.83%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=3.56%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=2.42%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=2.61%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.21%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_01_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=4.95%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=2.41%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=3.92%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=5.31%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ æ­£å¸¸\n",
      "      TGS2602_raw: CV=0.21%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_01_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.57%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.30%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.92%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.86%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.16%, é¡¯è‘—è·³è®Š=1æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_01_20250205...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.48%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.59%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.95%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.62%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.15%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_02_20250202...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=1.87%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=3.04%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=3.11%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=3.35%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.20%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_02_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=2.24%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=1.60%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=1.35%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=1.56%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.21%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_02_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.19%, é¡¯è‘—è·³è®Š=12æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.12%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=1.01%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=0.07%, é¡¯è‘—è·³è®Š=2æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.13%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_02_20250205...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=1.50%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=0.99%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=1.72%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=1.34%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.12%, é¡¯è‘—è·³è®Š=1æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_03_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.66%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.69%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=1.57%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=1.42%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=2.72%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_03_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 29 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.43%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.48%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.94%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.70%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=1.14%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "   âœ“ åŸå§‹: 913 rows\n",
      "   âœ“ ç§»é™¤: 13 rows (1.42%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_03_20250205...\n",
      "   âš ï¸  ç™¼ç¾ 29 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.81%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.49%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=1.83%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=1.36%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=1.26%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "   âœ“ åŸå§‹: 913 rows\n",
      "   âœ“ ç§»é™¤: 13 rows (1.42%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_04_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.47%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.93%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.71%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.71%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=1.58%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_04_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 29 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.18%, é¡¯è‘—è·³è®Š=71æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.06%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.65%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.71%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.70%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 913 rows\n",
      "   âœ“ ç§»é™¤: 13 rows (1.42%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_04_20250205...\n",
      "   âš ï¸  ç™¼ç¾ 29 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.38%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.04%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.82%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.56%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.48%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 913 rows\n",
      "   âœ“ ç§»é™¤: 14 rows (1.53%)\n",
      "   âœ“ ä¿ç•™: 899 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_05_20250202...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=1.06%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=2.46%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=1.18%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=1.31%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.39%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 911 rows\n",
      "   âœ“ ç§»é™¤: 11 rows (1.21%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_05_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.31%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.31%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.39%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.38%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.15%, é¡¯è‘—è·³è®Š=1æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 911 rows\n",
      "   âœ“ ç§»é™¤: 11 rows (1.21%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_05_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.62%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=3.00%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.64%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.78%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.44%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 911 rows\n",
      "   âœ“ ç§»é™¤: 11 rows (1.21%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_06_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.39%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.46%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.25%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.43%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.17%, é¡¯è‘—è·³è®Š=1æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 911 rows\n",
      "   âœ“ ç§»é™¤: 11 rows (1.21%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Air_06_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.44%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.60%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.29%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.52%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.23%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 911 rows\n",
      "   âœ“ ç§»é™¤: 11 rows (1.21%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_01_20250201...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=1.96%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=1.21%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=2.00%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=1.82%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.20%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_01_20250202...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=2.35%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=3.09%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=2.26%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=2.23%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.21%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_01_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=3.75%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=2.15%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=2.34%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=2.59%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.22%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_01_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.55%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.10%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.56%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=1.01%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.18%, é¡¯è‘—è·³è®Š=1æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_01_20250205...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.28%, é¡¯è‘—è·³è®Š=48æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.61%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.90%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.97%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.11%, é¡¯è‘—è·³è®Š=2æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_02_20250202...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=1.31%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=2.29%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=2.11%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=2.12%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.21%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_02_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=2.11%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=1.92%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=1.29%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ135_raw: CV=1.84%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      TGS2602_raw: CV=0.22%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_02_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.59%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.21%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.71%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.96%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.12%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_02_20250205...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=1.11%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ3_raw: CV=2.24%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.21%, é¡¯è‘—è·³è®Š=14æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.07%, é¡¯è‘—è·³è®Š=2æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.13%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_03_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.43%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.23%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.91%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.76%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=1.39%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_03_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 29 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.45%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.39%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.75%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.70%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=1.02%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "   âœ“ åŸå§‹: 913 rows\n",
      "   âœ“ ç§»é™¤: 13 rows (1.42%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_03_20250205...\n",
      "   âš ï¸  ç™¼ç¾ 29 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.41%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.18%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.95%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.69%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.90%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 913 rows\n",
      "   âœ“ ç§»é™¤: 13 rows (1.42%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_04_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.36%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.70%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.55%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.40%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=1.51%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "   âœ“ åŸå§‹: 912 rows\n",
      "   âœ“ ç§»é™¤: 12 rows (1.32%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_04_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 29 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.23%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.94%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.57%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.56%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=1.04%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "   âœ“ åŸå§‹: 913 rows\n",
      "   âœ“ ç§»é™¤: 13 rows (1.42%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_04_20250205...\n",
      "   âš ï¸  ç™¼ç¾ 29 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.49%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.07%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.84%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.59%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=1.41%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "   âœ“ åŸå§‹: 913 rows\n",
      "   âœ“ ç§»é™¤: 13 rows (1.42%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_05_20250202...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.60%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.49%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.82%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.68%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.66%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 911 rows\n",
      "   âœ“ ç§»é™¤: 11 rows (1.21%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_05_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.31%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.84%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.34%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.25%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.26%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 911 rows\n",
      "   âœ“ ç§»é™¤: 11 rows (1.21%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_05_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.52%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.86%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.39%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.55%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.29%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 911 rows\n",
      "   âœ“ ç§»é™¤: 11 rows (1.21%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_06_20250202...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.27%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=1.59%, é¡¯è‘—è·³è®Š=0æ¬¡, âœ“ ç©©å®š\n",
      "      MQ9_raw: CV=0.54%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.32%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.19%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 911 rows\n",
      "   âœ“ ç§»é™¤: 11 rows (1.21%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_06_20250203...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.49%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.67%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.42%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.54%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.27%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 911 rows\n",
      "   âœ“ ç§»é™¤: 11 rows (1.21%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "ğŸ§¹ æ¸…æ´— Pineapple_06_20250204...\n",
      "   âš ï¸  ç™¼ç¾ 25 å€‹ç¼ºå€¼\n",
      "   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\n",
      "      MQ2_raw: CV=0.30%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ3_raw: CV=0.79%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ9_raw: CV=0.18%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      MQ135_raw: CV=0.31%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "      TGS2602_raw: CV=0.21%, é¡¯è‘—è·³è®Š=0æ¬¡, âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\n",
      "   âœ“ åŸå§‹: 915 rows\n",
      "   âœ“ ç§»é™¤: 15 rows (1.64%)\n",
      "   âœ“ ä¿ç•™: 900 rows\n",
      "\n",
      "âœ… æ¸…æ´—å®Œæˆï¼\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 4: è³‡æ–™æ¸…æ´—å™¨ + æ„Ÿæ¸¬å™¨å¥åº·åº¦æª¢æŸ¥ =====\n",
    "\n",
    "class DataCleaner:\n",
    "    \"\"\"è³‡æ–™æ¸…æ´—èˆ‡é©—è­‰\"\"\"\n",
    "    \n",
    "    def __init__(self):\n",
    "        # å®šç¾©ç•°å¸¸å€¼ç¯„åœï¼ˆæ ¹æ“šä½ çš„ Arduino codeï¼‰\n",
    "        self.validation_rules = {\n",
    "            'MQ2_raw': (10, 1000),\n",
    "            'MQ3_raw': (10, 1000),\n",
    "            'MQ9_raw': (10, 1000),\n",
    "            'MQ135_raw': (10, 1000),\n",
    "            'TGS2602_raw': (10, 1000),\n",
    "            'Temp_C': (0, 50),\n",
    "            'Humidity_pct': (0, 100),\n",
    "            'Pressure_hPa': (800, 1100)\n",
    "        }\n",
    "        self.sensor_cols = ['MQ2_raw', 'MQ3_raw', 'MQ9_raw', 'MQ135_raw', 'TGS2602_raw']\n",
    "    \n",
    "    def clean_dataset(self, df, dataset_name=\"Dataset\"):\n",
    "        \"\"\"æ¸…æ´—å–®ä¸€æ•¸æ“šé›†\"\"\"\n",
    "        print(f\"\\nğŸ§¹ æ¸…æ´— {dataset_name}...\")\n",
    "        \n",
    "        original_rows = len(df)\n",
    "        \n",
    "        # 1. ç§»é™¤å®Œå…¨é‡è¤‡çš„è¡Œ\n",
    "        df = df.drop_duplicates()\n",
    "        \n",
    "        # 2. æª¢æŸ¥ä¸¦è™•ç†ç¼ºå€¼\n",
    "        missing_before = df.isnull().sum().sum()\n",
    "        if missing_before > 0:\n",
    "            print(f\"   âš ï¸  ç™¼ç¾ {missing_before} å€‹ç¼ºå€¼\")\n",
    "            df = df.dropna().reset_index(drop=True)  # ğŸ‘ˆ é—œéµï¼šé‡ç½® index\n",
    "        \n",
    "        # 3. ç•°å¸¸å€¼éæ¿¾\n",
    "        mask = pd.Series([True] * len(df))\n",
    "        outlier_counts = {}\n",
    "        \n",
    "        for col, (min_val, max_val) in self.validation_rules.items():\n",
    "            if col in df.columns:\n",
    "                col_mask = (df[col] >= min_val) & (df[col] <= max_val)\n",
    "                outliers = (~col_mask).sum()\n",
    "                if outliers > 0:\n",
    "                    outlier_counts[col] = outliers\n",
    "                mask &= col_mask\n",
    "        \n",
    "        df_clean = df[mask].copy()\n",
    "        \n",
    "        # 4. æ™‚é–“å°é½Šï¼ˆé‡è¨­ timestamp_s å¾ 0 é–‹å§‹ï¼‰\n",
    "        if 'timestamp_ms' in df_clean.columns:\n",
    "            df_clean['timestamp_s'] = (df_clean['timestamp_ms'] - df_clean['timestamp_ms'].iloc[0]) / 1000.0\n",
    "        \n",
    "        # 5. æ„Ÿæ¸¬å™¨å¥åº·åº¦æª¢æŸ¥\n",
    "        health_report = self.check_sensor_health(df_clean, dataset_name)\n",
    "        \n",
    "        # å ±å‘Š\n",
    "        removed_rows = original_rows - len(df_clean)\n",
    "        print(f\"   âœ“ åŸå§‹: {original_rows} rows\")\n",
    "        print(f\"   âœ“ ç§»é™¤: {removed_rows} rows ({removed_rows/original_rows*100:.2f}%)\")\n",
    "        print(f\"   âœ“ ä¿ç•™: {len(df_clean)} rows\")\n",
    "        \n",
    "        if outlier_counts:\n",
    "            print(f\"   ğŸ“Š ç•°å¸¸å€¼çµ±è¨ˆ:\")\n",
    "            for col, count in outlier_counts.items():\n",
    "                print(f\"      - {col}: {count}\")\n",
    "        \n",
    "        return df_clean, {\n",
    "            'original_rows': original_rows,\n",
    "            'removed_rows': removed_rows,\n",
    "            'outlier_counts': outlier_counts,\n",
    "            'final_rows': len(df_clean),\n",
    "            'sensor_health': health_report\n",
    "        }\n",
    "    \n",
    "    def check_sensor_health(self, df, dataset_name):\n",
    "        \"\"\"æª¢æŸ¥æ„Ÿæ¸¬å™¨å¥åº·åº¦\"\"\"\n",
    "        print(f\"   ğŸ”¬ æ„Ÿæ¸¬å™¨å¥åº·åº¦:\")\n",
    "        \n",
    "        health_report = {}\n",
    "        \n",
    "        for col in self.sensor_cols:\n",
    "            if col in df.columns:\n",
    "                mean_val = df[col].mean()\n",
    "                std_val = df[col].std()\n",
    "                cv = (std_val / mean_val * 100) if mean_val != 0 else 0\n",
    "                \n",
    "                # æª¢æŸ¥é¡¯è‘—è·³è®Šï¼ˆ> 5 å€‹æ¨™æº–å·®ï¼‰\n",
    "                diff = df[col].diff().abs()\n",
    "                significant_jumps = (diff > std_val * 5).sum() if std_val > 0 else 0\n",
    "                \n",
    "                # è©•ç´š\n",
    "                if cv < 1:\n",
    "                    grade = \"âš ï¸ æ¥µç©©å®šï¼ˆå¯èƒ½æœªæ¥è§¸æ°£é«”ï¼‰\"\n",
    "                elif cv < 5:\n",
    "                    grade = \"âœ“ ç©©å®š\"\n",
    "                elif cv < 15:\n",
    "                    grade = \"âœ“ æ­£å¸¸\"\n",
    "                else:\n",
    "                    grade = \"âš ï¸ è®ŠåŒ–è¼ƒå¤§\"\n",
    "                \n",
    "                health_report[col] = {\n",
    "                    'cv_percent': cv,\n",
    "                    'significant_jumps': significant_jumps,\n",
    "                    'grade': grade\n",
    "                }\n",
    "                \n",
    "                print(f\"      {col}: CV={cv:.2f}%, é¡¯è‘—è·³è®Š={significant_jumps}æ¬¡, {grade}\")\n",
    "        \n",
    "        return health_report\n",
    "    \n",
    "    def clean_all_data(self, air_data, pineapple_data):\n",
    "        \"\"\"æ‰¹æ¬¡æ¸…æ´—æ‰€æœ‰æ•¸æ“š\"\"\"\n",
    "        print(\"=\"*50)\n",
    "        print(\"ğŸ§¹ é–‹å§‹æ‰¹æ¬¡æ¸…æ´—æ•¸æ“š\")\n",
    "        print(\"=\"*50)\n",
    "        \n",
    "        cleaned_air = {}\n",
    "        cleaned_pineapple = {}\n",
    "        cleaning_report = {'air': {}, 'pineapple': {}}\n",
    "        \n",
    "        # æ¸…æ´— air baseline\n",
    "        for pid, df in air_data.items():\n",
    "            cleaned_air[pid], cleaning_report['air'][pid] = \\\n",
    "                self.clean_dataset(df, f\"Air_{pid}\")\n",
    "        \n",
    "        # æ¸…æ´— pineapple\n",
    "        for pid, date_dict in pineapple_data.items():\n",
    "            cleaned_pineapple[pid] = {}\n",
    "            cleaning_report['pineapple'][pid] = {}\n",
    "            for date, df in date_dict.items():\n",
    "                cleaned_pineapple[pid][date], cleaning_report['pineapple'][pid][date] = \\\n",
    "                    self.clean_dataset(df, f\"Pineapple_{pid}_{date}\")\n",
    "        \n",
    "        print(\"\\nâœ… æ¸…æ´—å®Œæˆï¼\")\n",
    "        return cleaned_air, cleaned_pineapple, cleaning_report\n",
    "\n",
    "# åŸ·è¡Œæ¸…æ´—\n",
    "cleaner = DataCleaner()\n",
    "cleaned_air, cleaned_pineapple, cleaning_report = cleaner.clean_all_data(air_data, pineapple_data)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 73,
   "id": "b40c53d0-f37e-4ef3-acb0-63b878c78215",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "ğŸ“ è¨ˆç®— Delta (Pineapple - Air)...\n",
      "   ğŸ”„ Pineapple_01_20250201 (ä½¿ç”¨ Air key=01_20250201)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_01_20250202 (ä½¿ç”¨ Air key=01_20250202)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_01_20250203 (ä½¿ç”¨ Air key=01_20250203)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_01_20250204 (ä½¿ç”¨ Air key=01_20250204)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_01_20250205 (ä½¿ç”¨ Air key=01_20250205)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_02_20250202 (ä½¿ç”¨ Air key=02_20250202)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_02_20250203 (ä½¿ç”¨ Air key=02_20250203)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_02_20250204 (ä½¿ç”¨ Air key=02_20250204)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_02_20250205 (ä½¿ç”¨ Air key=02_20250205)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_03_20250203 (ä½¿ç”¨ Air key=03_20250203)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_03_20250204 (ä½¿ç”¨ Air key=03_20250204)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_03_20250205 (ä½¿ç”¨ Air key=03_20250205)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_04_20250203 (ä½¿ç”¨ Air key=04_20250203)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_04_20250204 (ä½¿ç”¨ Air key=04_20250204)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_04_20250205 (ä½¿ç”¨ Air key=04_20250205)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_05_20250202 (ä½¿ç”¨ Air key=05_20250202)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_05_20250203 (ä½¿ç”¨ Air key=05_20250203)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_05_20250204 (ä½¿ç”¨ Air key=05_20250204)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   âš ï¸  Pineapple_06_20250202 æ‰¾ä¸åˆ°å°æ‡‰çš„ Air baselineï¼ˆkey=06_20250202ï¼‰ï¼Œè·³é\n",
      "   ğŸ”„ Pineapple_06_20250203 (ä½¿ç”¨ Air key=06_20250203)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "   ğŸ”„ Pineapple_06_20250204 (ä½¿ç”¨ Air key=06_20250204)\n",
      "      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\n",
      "âœ… Delta è¨ˆç®—å®Œæˆï¼\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 5: Deltaï¼ˆé³³æ¢¨ - Airï¼‰è¨ˆç®—ï¼ˆä¿ç•™ Arduino ç‰¹å¾µï¼‰=====\n",
    "\n",
    "class DeltaCalculator:\n",
    "    \"\"\"è¨ˆç®—é³³æ¢¨èˆ‡ air baseline çš„å·®ç•°\"\"\"\n",
    "    \n",
    "    def __init__(self):\n",
    "        self.sensor_cols = ['MQ2_raw', 'MQ3_raw', 'MQ9_raw', 'MQ135_raw', 'TGS2602_raw']\n",
    "        self.env_cols = ['Temp_C', 'Humidity_pct', 'Pressure_hPa']\n",
    "        \n",
    "        # ğŸ‘ˆ æ–°å¢ï¼šArduino å·²ç¶“ç®—å¥½çš„ç‰¹å¾µæ¬„ä½\n",
    "        self.arduino_feature_cols = [\n",
    "            'MQ2_logr', 'MQ3_logr', 'MQ9_logr', 'MQ135_logr', 'TGS2602_logr',\n",
    "            'MQ2_dlogr', 'MQ3_dlogr', 'MQ9_dlogr', 'MQ135_dlogr', 'TGS2602_dlogr',\n",
    "            'MQ2_logr_ma5', 'MQ3_logr_ma5', 'MQ9_logr_ma5', 'MQ135_logr_ma5', 'TGS2602_logr_ma5'\n",
    "        ]\n",
    "    \n",
    "    def calculate_delta(self, pineapple_df, air_df):\n",
    "        \"\"\"è¨ˆç®—å–®ä¸€é³³æ¢¨çš„ delta å€¼ï¼ˆä¿ç•™ Arduino ç‰¹å¾µï¼‰\"\"\"\n",
    "        # ğŸ‘ˆ ä½¿ç”¨ .copy() ä¿ç•™æ‰€æœ‰åŸå§‹æ¬„ä½ï¼ˆåŒ…å« Arduino ç‰¹å¾µï¼‰\n",
    "        delta_df = pineapple_df.copy()\n",
    "        \n",
    "        # è¨ˆç®— air baseline çš„å¹³å‡å€¼\n",
    "        air_means = {}\n",
    "        for col in self.sensor_cols + self.env_cols:\n",
    "            if col in air_df.columns:\n",
    "                air_means[col] = air_df[col].mean()\n",
    "        \n",
    "        # è¨ˆç®—ç°¡å–® deltaï¼ˆé³³æ¢¨ - airï¼‰ç”¨æ–¼è¦–è¦ºåŒ–æ¯”è¼ƒ\n",
    "        for col in self.sensor_cols:\n",
    "            if col in air_means:\n",
    "                delta_df[f'{col}_delta_simple'] = delta_df[col] - air_means[col]\n",
    "                delta_df[f'{col}_delta_pct'] = (delta_df[col] - air_means[col]) / air_means[col] * 100\n",
    "        \n",
    "        # ç’°å¢ƒåƒæ•¸ä¹Ÿè¨ˆç®— deltaï¼ˆç”¨æ–¼ç›£æ§ç’°å¢ƒè®ŠåŒ–ï¼‰\n",
    "        for col in self.env_cols:\n",
    "            if col in air_means:\n",
    "                delta_df[f'{col}_delta'] = delta_df[col] - air_means[col]\n",
    "        \n",
    "        # ğŸ‘ˆ æ–°å¢ï¼šæ¨™è¨˜æ˜¯å¦æœ‰ Arduino ç‰¹å¾µ\n",
    "        has_arduino_features = all(col in delta_df.columns for col in self.arduino_feature_cols)\n",
    "        \n",
    "        # å„²å­˜ baseline åƒè€ƒå€¼å’Œç‰¹å¾µæ¨™è¨˜\n",
    "        delta_df.attrs['air_baseline'] = air_means\n",
    "        delta_df.attrs['has_arduino_features'] = has_arduino_features\n",
    "        \n",
    "        if has_arduino_features:\n",
    "            print(f\"      âœ“ åµæ¸¬åˆ° Arduino é è™•ç†ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\")\n",
    "        else:\n",
    "            print(f\"      âš ï¸  æœªåµæ¸¬åˆ°å®Œæ•´çš„ Arduino ç‰¹å¾µ\")\n",
    "        \n",
    "        return delta_df\n",
    "    \n",
    "    def calculate_all_deltas(self, cleaned_pineapple, cleaned_air):\n",
    "        \"\"\"æ‰¹æ¬¡è¨ˆç®—æ‰€æœ‰é³³æ¢¨çš„ delta\n",
    "        \n",
    "        cleaned_air çš„ key ä¾å‘½åè¦å‰‡ç‚º \"é³³æ¢¨ç·¨è™Ÿ_æ—¥æœŸ\"\n",
    "        cleaned_pineapple ç‚º {pineapple_id: {date: df}}\n",
    "        \"\"\"\n",
    "        print(\"\\nğŸ“ è¨ˆç®— Delta (Pineapple - Air)...\")\n",
    "        \n",
    "        delta_data = {}\n",
    "        \n",
    "        for pid, date_dict in cleaned_pineapple.items():\n",
    "            delta_data[pid] = {}\n",
    "            for date, pineapple_df in date_dict.items():\n",
    "                air_key = f\"{pid}_{date}\"\n",
    "                if air_key not in cleaned_air:\n",
    "                    print(f\"   âš ï¸  Pineapple_{pid}_{date} æ‰¾ä¸åˆ°å°æ‡‰çš„ Air baselineï¼ˆkey={air_key}ï¼‰ï¼Œè·³é\")\n",
    "                    continue\n",
    "                \n",
    "                air_df = cleaned_air[air_key]\n",
    "                print(f\"   ğŸ”„ Pineapple_{pid}_{date} (ä½¿ç”¨ Air key={air_key})\")\n",
    "                delta_df = self.calculate_delta(pineapple_df, air_df)\n",
    "                delta_data[pid][date] = delta_df\n",
    "        \n",
    "        print(\"âœ… Delta è¨ˆç®—å®Œæˆï¼\")\n",
    "        return delta_data\n",
    "\n",
    "# åŸ·è¡Œ delta è¨ˆç®—\n",
    "delta_calc = DeltaCalculator()\n",
    "delta_data = delta_calc.calculate_all_deltas(cleaned_pineapple, cleaned_air)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 74,
   "id": "8cc98c1c-53cd-4361-ac07-5bd18c6e9e2c",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "ğŸ“ˆ ç¹ªè£½ Raw æ™‚åºåœ–...\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_01_20250201_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_01_20250202_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_01_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_01_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_01_20250205_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_02_20250202_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_02_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_02_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_02_20250205_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_03_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_03_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_03_20250205_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_04_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_04_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_04_20250205_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_05_20250202_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_05_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_05_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_06_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/air_06_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_01_20250201_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_01_20250202_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_01_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_01_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_01_20250205_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_02_20250202_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_02_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_02_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_02_20250205_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_03_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_03_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_03_20250205_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_04_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_04_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_04_20250205_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_05_20250202_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_05_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_05_20250204_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_06_20250202_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_06_20250203_raw.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/raw_timeseries/pineapple_06_20250204_raw.html\n",
      "âœ… Raw æ™‚åºåœ–ç¹ªè£½å®Œæˆï¼\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 6: è¦–è¦ºåŒ– - Raw æ™‚åºåœ– =====\n",
    "\n",
    "class TimeSeriesVisualizer:\n",
    "    \"\"\"æ™‚åºåœ–è¦–è¦ºåŒ–\"\"\"\n",
    "    \n",
    "    def __init__(self, output_dir='reports/figures'):\n",
    "        self.output_dir = output_dir\n",
    "        self.sensor_cols = ['MQ2_raw', 'MQ3_raw', 'MQ9_raw', 'MQ135_raw', 'TGS2602_raw']\n",
    "        self.env_cols = ['Temp_C', 'Humidity_pct', 'Pressure_hPa']\n",
    "        \n",
    "    def plot_raw_timeseries(self, df, title, save_path=None):\n",
    "        \"\"\"ç¹ªè£½ raw å€¼æ™‚åºåœ–ï¼ˆ8 subplotsï¼‰\"\"\"\n",
    "        fig = make_subplots(\n",
    "            rows=3, cols=3,\n",
    "            subplot_titles=[\n",
    "                'MQ2 (Smoke)', 'MQ3 (Alcohol)', 'MQ9 (CO/CH4)',\n",
    "                'MQ135 (NH3/CO2)', 'TGS2602 (VOC)', 'Temperature',\n",
    "                'Humidity', 'Pressure', ''\n",
    "            ],\n",
    "            vertical_spacing=0.08,\n",
    "            horizontal_spacing=0.08\n",
    "        )\n",
    "        \n",
    "        time_col = 'timestamp_s' if 'timestamp_s' in df.columns else df.index\n",
    "        \n",
    "        # æ„Ÿæ¸¬å™¨æ•¸æ“š\n",
    "        sensors = [\n",
    "            ('MQ2_raw', 1, 1, 'blue'),\n",
    "            ('MQ3_raw', 1, 2, 'red'),\n",
    "            ('MQ9_raw', 1, 3, 'green'),\n",
    "            ('MQ135_raw', 2, 1, 'purple'),\n",
    "            ('TGS2602_raw', 2, 2, 'orange'),\n",
    "            ('Temp_C', 2, 3, 'darkred'),\n",
    "            ('Humidity_pct', 3, 1, 'cyan'),\n",
    "            ('Pressure_hPa', 3, 2, 'brown')\n",
    "        ]\n",
    "        \n",
    "        for col, row, col_pos, color in sensors:\n",
    "            if col in df.columns:\n",
    "                fig.add_trace(\n",
    "                    go.Scatter(\n",
    "                        x=df[time_col] if isinstance(time_col, str) else time_col,\n",
    "                        y=df[col],\n",
    "                        mode='lines',\n",
    "                        name=col,\n",
    "                        line=dict(color=color, width=1.5),\n",
    "                        showlegend=False\n",
    "                    ),\n",
    "                    row=row, col=col_pos\n",
    "                )\n",
    "        \n",
    "        fig.update_xaxes(title_text=\"Time (s)\", row=3)\n",
    "        fig.update_yaxes(title_text=\"ADC Value\", row=1, col=1)\n",
    "        fig.update_yaxes(title_text=\"ADC Value\", row=2, col=1)\n",
    "        fig.update_yaxes(title_text=\"Â°C\", row=2, col=3)\n",
    "        fig.update_yaxes(title_text=\"%\", row=3, col=1)\n",
    "        fig.update_yaxes(title_text=\"hPa\", row=3, col=2)\n",
    "        \n",
    "        fig.update_layout(\n",
    "            title_text=title,\n",
    "            height=900,\n",
    "            showlegend=False,\n",
    "            template='plotly_white'\n",
    "        )\n",
    "        \n",
    "        if save_path:\n",
    "            fig.write_html(save_path)\n",
    "            print(f\"   ğŸ’¾ å·²å„²å­˜: {save_path}\")\n",
    "        \n",
    "        return fig\n",
    "    \n",
    "    def plot_all_raw_timeseries(self, cleaned_air, cleaned_pineapple):\n",
    "        \"\"\"æ‰¹æ¬¡ç¹ªè£½æ‰€æœ‰ raw æ™‚åºåœ–\"\"\"\n",
    "        print(\"\\nğŸ“ˆ ç¹ªè£½ Raw æ™‚åºåœ–...\")\n",
    "        \n",
    "        # Air baseline\n",
    "        for pid, df in cleaned_air.items():\n",
    "            save_path = f\"{self.output_dir}/raw_timeseries/air_{pid}_raw.html\"\n",
    "            self.plot_raw_timeseries(df, f\"Air Baseline - {pid}\", save_path)\n",
    "        \n",
    "        # Pineapple\n",
    "        for pid, date_dict in cleaned_pineapple.items():\n",
    "            for date, df in date_dict.items():\n",
    "                save_path = f\"{self.output_dir}/raw_timeseries/pineapple_{pid}_{date}_raw.html\"\n",
    "                self.plot_raw_timeseries(df, f\"Pineapple {pid} - {date}\", save_path)\n",
    "        \n",
    "        print(\"âœ… Raw æ™‚åºåœ–ç¹ªè£½å®Œæˆï¼\")\n",
    "\n",
    "# åŸ·è¡Œè¦–è¦ºåŒ–\n",
    "visualizer = TimeSeriesVisualizer()\n",
    "visualizer.plot_all_raw_timeseries(cleaned_air, cleaned_pineapple)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 75,
   "id": "29b57abb-d434-4c48-9fc7-a33ab9978b25",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "ğŸ“‰ ç¹ªè£½ Delta æ™‚åºåœ–...\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_01_20250201_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_01_20250202_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_01_20250203_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_01_20250204_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_01_20250205_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_02_20250202_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_02_20250203_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_02_20250204_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_02_20250205_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_03_20250203_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_03_20250204_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_03_20250205_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_04_20250203_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_04_20250204_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_04_20250205_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_05_20250202_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_05_20250203_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_05_20250204_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_06_20250203_delta.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/delta_timeseries/pineapple_06_20250204_delta.html\n",
      "âœ… Delta æ™‚åºåœ–ç¹ªè£½å®Œæˆï¼\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 7: è¦–è¦ºåŒ– - Delta æ™‚åºåœ– =====\n",
    "\n",
    "class DeltaVisualizer:\n",
    "    \"\"\"Delta æ™‚åºåœ–è¦–è¦ºåŒ–\"\"\"\n",
    "    \n",
    "    def __init__(self, output_dir='reports/figures'):\n",
    "        self.output_dir = output_dir\n",
    "        self.sensor_cols = ['MQ2_raw', 'MQ3_raw', 'MQ9_raw', 'MQ135_raw', 'TGS2602_raw']\n",
    "    \n",
    "    def plot_delta_timeseries(self, delta_df, title, save_path=None):\n",
    "        \"\"\"ç¹ªè£½ delta æ™‚åºåœ–\"\"\"\n",
    "        fig = make_subplots(\n",
    "            rows=2, cols=3,\n",
    "            subplot_titles=[\n",
    "                'Î”MQ2', 'Î”MQ3', 'Î”MQ9',\n",
    "                'Î”MQ135', 'Î”TGS2602', 'Î”% Comparison'\n",
    "            ],\n",
    "            specs=[\n",
    "                [{\"secondary_y\": False}, {\"secondary_y\": False}, {\"secondary_y\": False}],\n",
    "                [{\"secondary_y\": False}, {\"secondary_y\": False}, {\"secondary_y\": False}]\n",
    "            ],\n",
    "            vertical_spacing=0.12,\n",
    "            horizontal_spacing=0.1\n",
    "        )\n",
    "        \n",
    "        time_col = 'timestamp_s' if 'timestamp_s' in delta_df.columns else delta_df.index\n",
    "        \n",
    "        colors = ['blue', 'red', 'green', 'purple', 'orange']\n",
    "        \n",
    "        # ç¹ªè£½çµ•å° delta\n",
    "        for idx, (col, color) in enumerate(zip(self.sensor_cols, colors)):\n",
    "            delta_col = f'{col}_delta_simple'\n",
    "            if delta_col in delta_df.columns:\n",
    "                row = (idx // 3) + 1\n",
    "                col_pos = (idx % 3) + 1\n",
    "                \n",
    "                fig.add_trace(\n",
    "                    go.Scatter(\n",
    "                        x=delta_df[time_col] if isinstance(time_col, str) else time_col,\n",
    "                        y=delta_df[delta_col],\n",
    "                        mode='lines',\n",
    "                        name=col.replace('_raw', ''),\n",
    "                        line=dict(color=color, width=1.5),\n",
    "                        showlegend=(idx < 5)\n",
    "                    ),\n",
    "                    row=row, col=col_pos\n",
    "                )\n",
    "                \n",
    "                # åŠ å…¥é›¶ç·š\n",
    "                fig.add_hline(y=0, line_dash=\"dash\", line_color=\"gray\", \n",
    "                             opacity=0.5, row=row, col=col_pos)\n",
    "        \n",
    "        # ç¬¬ 6 å€‹å­åœ–ï¼šç™¾åˆ†æ¯”è®ŠåŒ–æ¯”è¼ƒ\n",
    "        for col, color in zip(self.sensor_cols, colors):\n",
    "            pct_col = f'{col}_delta_pct'\n",
    "            if pct_col in delta_df.columns:\n",
    "                fig.add_trace(\n",
    "                    go.Scatter(\n",
    "                        x=delta_df[time_col] if isinstance(time_col, str) else time_col,\n",
    "                        y=delta_df[pct_col],\n",
    "                        mode='lines',\n",
    "                        name=col.replace('_raw', ''),\n",
    "                        line=dict(color=color, width=1.5),\n",
    "                        showlegend=False\n",
    "                    ),\n",
    "                    row=2, col=3\n",
    "                )\n",
    "        \n",
    "        fig.add_hline(y=0, line_dash=\"dash\", line_color=\"gray\", \n",
    "                     opacity=0.5, row=2, col=3)\n",
    "        \n",
    "        # æ›´æ–°è»¸æ¨™ç±¤\n",
    "        fig.update_xaxes(title_text=\"Time (s)\", row=2)\n",
    "        fig.update_yaxes(title_text=\"Î” ADC\", row=1, col=1)\n",
    "        fig.update_yaxes(title_text=\"Î” ADC\", row=2, col=1)\n",
    "        fig.update_yaxes(title_text=\"Î” %\", row=2, col=3)\n",
    "        \n",
    "        fig.update_layout(\n",
    "            title_text=title,\n",
    "            height=700,\n",
    "            template='plotly_white'\n",
    "        )\n",
    "        \n",
    "        if save_path:\n",
    "            fig.write_html(save_path)\n",
    "            print(f\"   ğŸ’¾ å·²å„²å­˜: {save_path}\")\n",
    "        \n",
    "        return fig\n",
    "    \n",
    "    def plot_all_delta_timeseries(self, delta_data):\n",
    "        \"\"\"æ‰¹æ¬¡ç¹ªè£½æ‰€æœ‰ delta æ™‚åºåœ–\"\"\"\n",
    "        print(\"\\nğŸ“‰ ç¹ªè£½ Delta æ™‚åºåœ–...\")\n",
    "        \n",
    "        for pid, date_dict in delta_data.items():\n",
    "            for date, delta_df in date_dict.items():\n",
    "                save_path = f\"{self.output_dir}/delta_timeseries/pineapple_{pid}_{date}_delta.html\"\n",
    "                self.plot_delta_timeseries(\n",
    "                    delta_df, \n",
    "                    f\"Î” (Pineapple - Air) | Pineapple {pid} - {date}\", \n",
    "                    save_path\n",
    "                )\n",
    "        \n",
    "        print(\"âœ… Delta æ™‚åºåœ–ç¹ªè£½å®Œæˆï¼\")\n",
    "\n",
    "# åŸ·è¡Œ delta è¦–è¦ºåŒ–\n",
    "delta_viz = DeltaVisualizer()\n",
    "delta_viz.plot_all_delta_timeseries(delta_data)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 76,
   "id": "b2634e44-106d-483d-ac73-637244722814",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "ğŸ¨ ç¹ªè£½ Arduino ç‰¹å¾µåœ–...\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_01_20250201_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_01_20250202_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_01_20250203_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_01_20250204_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_01_20250205_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_02_20250202_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_02_20250203_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_02_20250204_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_02_20250205_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_03_20250203_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_03_20250204_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_03_20250205_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_04_20250203_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_04_20250204_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_04_20250205_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_05_20250202_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_05_20250203_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_05_20250204_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_06_20250203_arduino.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/arduino_features/pineapple_06_20250204_arduino.html\n",
      "âœ… Arduino ç‰¹å¾µåœ–ç¹ªè£½å®Œæˆï¼å…± 20 å¼µ\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 8: è¦–è¦ºåŒ– - Arduino é è™•ç†ç‰¹å¾µï¼ˆæ–°å¢ï¼‰=====\n",
    "\n",
    "class ArduinoFeatureVisualizer:\n",
    "    \"\"\"Arduino é è™•ç†ç‰¹å¾µè¦–è¦ºåŒ–\"\"\"\n",
    "    \n",
    "    def __init__(self, output_dir='reports/figures'):\n",
    "        self.output_dir = output_dir\n",
    "        self.sensor_names = ['MQ2', 'MQ3', 'MQ9', 'MQ135', 'TGS2602']\n",
    "    \n",
    "    def plot_arduino_features(self, delta_df, title, save_path=None):\n",
    "        \"\"\"ç¹ªè£½ Arduino é è™•ç†çš„ç‰¹å¾µï¼ˆlog ratio, delta log ratio, MA5ï¼‰\"\"\"\n",
    "        \n",
    "        if not delta_df.attrs.get('has_arduino_features', False):\n",
    "            print(f\"   âš ï¸  {title} æ²’æœ‰ Arduino ç‰¹å¾µï¼Œè·³é\")\n",
    "            return None\n",
    "        \n",
    "        fig = make_subplots(\n",
    "            rows=3, cols=2,\n",
    "            subplot_titles=[\n",
    "                'Log Ratio (Baseline Normalized)', 'Log Ratio MA5 (Smoothed)',\n",
    "                'Delta Log Ratio (Rate of Change)', 'Delta Log Ratio Detail',\n",
    "                'Multi-Sensor Comparison (Log Ratio)', 'Multi-Sensor Comparison (MA5)'\n",
    "            ],\n",
    "            vertical_spacing=0.1,\n",
    "            horizontal_spacing=0.1\n",
    "        )\n",
    "        \n",
    "        time_col = 'timestamp_s' if 'timestamp_s' in delta_df.columns else delta_df.index\n",
    "        colors = ['blue', 'red', 'green', 'purple', 'orange']\n",
    "        \n",
    "        # Row 1: Log Ratio (åŸå§‹ & MA5)\n",
    "        for sensor, color in zip(self.sensor_names, colors):\n",
    "            logr_col = f'{sensor}_logr'\n",
    "            ma5_col = f'{sensor}_logr_ma5'\n",
    "            \n",
    "            if logr_col in delta_df.columns:\n",
    "                # Log Ratio\n",
    "                fig.add_trace(\n",
    "                    go.Scatter(\n",
    "                        x=delta_df[time_col] if isinstance(time_col, str) else time_col,\n",
    "                        y=delta_df[logr_col],\n",
    "                        mode='lines',\n",
    "                        name=sensor,\n",
    "                        line=dict(color=color, width=1),\n",
    "                        legendgroup=sensor,\n",
    "                        showlegend=True\n",
    "                    ),\n",
    "                    row=1, col=1\n",
    "                )\n",
    "                \n",
    "                # MA5\n",
    "                if ma5_col in delta_df.columns:\n",
    "                    fig.add_trace(\n",
    "                        go.Scatter(\n",
    "                            x=delta_df[time_col] if isinstance(time_col, str) else time_col,\n",
    "                            y=delta_df[ma5_col],\n",
    "                            mode='lines',\n",
    "                            name=sensor,\n",
    "                            line=dict(color=color, width=1.5),\n",
    "                            legendgroup=sensor,\n",
    "                            showlegend=False\n",
    "                        ),\n",
    "                        row=1, col=2\n",
    "                    )\n",
    "        \n",
    "        # Row 2: Delta Log Ratio\n",
    "        for sensor, color in zip(self.sensor_names, colors):\n",
    "            dlogr_col = f'{sensor}_dlogr'\n",
    "            \n",
    "            if dlogr_col in delta_df.columns:\n",
    "                # Delta Log Ratio (å…¨åœ–)\n",
    "                fig.add_trace(\n",
    "                    go.Scatter(\n",
    "                        x=delta_df[time_col] if isinstance(time_col, str) else time_col,\n",
    "                        y=delta_df[dlogr_col],\n",
    "                        mode='lines',\n",
    "                        name=sensor,\n",
    "                        line=dict(color=color, width=1),\n",
    "                        legendgroup=sensor,\n",
    "                        showlegend=False\n",
    "                    ),\n",
    "                    row=2, col=1\n",
    "                )\n",
    "                \n",
    "                # Delta Log Ratio Detail (æ”¾å¤§çœ‹ç´°ç¯€)\n",
    "                fig.add_trace(\n",
    "                    go.Scatter(\n",
    "                        x=delta_df[time_col] if isinstance(time_col, str) else time_col,\n",
    "                        y=delta_df[dlogr_col],\n",
    "                        mode='markers+lines',\n",
    "                        name=sensor,\n",
    "                        line=dict(color=color, width=0.5),\n",
    "                        marker=dict(size=2),\n",
    "                        legendgroup=sensor,\n",
    "                        showlegend=False\n",
    "                    ),\n",
    "                    row=2, col=2\n",
    "                )\n",
    "        \n",
    "        # Row 3: Multi-Sensor ç¶œåˆæ¯”è¼ƒ\n",
    "        for sensor, color in zip(self.sensor_names, colors):\n",
    "            logr_col = f'{sensor}_logr'\n",
    "            ma5_col = f'{sensor}_logr_ma5'\n",
    "            \n",
    "            if logr_col in delta_df.columns:\n",
    "                fig.add_trace(\n",
    "                    go.Scatter(\n",
    "                        x=delta_df[time_col] if isinstance(time_col, str) else time_col,\n",
    "                        y=delta_df[logr_col],\n",
    "                        mode='lines',\n",
    "                        name=sensor,\n",
    "                        line=dict(color=color, width=1, dash='dot'),\n",
    "                        legendgroup=sensor,\n",
    "                        showlegend=False\n",
    "                    ),\n",
    "                    row=3, col=1\n",
    "                )\n",
    "                \n",
    "                if ma5_col in delta_df.columns:\n",
    "                    fig.add_trace(\n",
    "                        go.Scatter(\n",
    "                            x=delta_df[time_col] if isinstance(time_col, str) else time_col,\n",
    "                            y=delta_df[ma5_col],\n",
    "                            mode='lines',\n",
    "                            name=sensor,\n",
    "                            line=dict(color=color, width=1.5),\n",
    "                            legendgroup=sensor,\n",
    "                            showlegend=False\n",
    "                        ),\n",
    "                        row=3, col=2\n",
    "                    )\n",
    "        \n",
    "        # åŠ å…¥é›¶ç·š\n",
    "        for row in [1, 2, 3]:\n",
    "            for col in [1, 2]:\n",
    "                fig.add_hline(y=0, line_dash=\"dash\", line_color=\"gray\", \n",
    "                             opacity=0.3, row=row, col=col)\n",
    "        \n",
    "        # æ›´æ–°è»¸æ¨™ç±¤\n",
    "        fig.update_xaxes(title_text=\"Time (s)\", row=3)\n",
    "        fig.update_yaxes(title_text=\"Log Ratio\", row=1, col=1)\n",
    "        fig.update_yaxes(title_text=\"Log Ratio (MA5)\", row=1, col=2)\n",
    "        fig.update_yaxes(title_text=\"Î” Log Ratio\", row=2, col=1)\n",
    "        fig.update_yaxes(title_text=\"Î” Log Ratio (Detail)\", row=2, col=2)\n",
    "        fig.update_yaxes(title_text=\"Log Ratio (All)\", row=3, col=1)\n",
    "        fig.update_yaxes(title_text=\"MA5 (All)\", row=3, col=2)\n",
    "        \n",
    "        fig.update_layout(\n",
    "            title_text=f\"Arduino Preprocessed Features - {title}\",\n",
    "            height=1000,\n",
    "            template='plotly_white',\n",
    "            legend=dict(orientation=\"h\", yanchor=\"bottom\", y=1.02, xanchor=\"right\", x=1)\n",
    "        )\n",
    "        \n",
    "        if save_path:\n",
    "            fig.write_html(save_path)\n",
    "            print(f\"   ğŸ’¾ å·²å„²å­˜: {save_path}\")\n",
    "        \n",
    "        return fig\n",
    "    \n",
    "    def plot_all_arduino_features(self, delta_data):\n",
    "        \"\"\"æ‰¹æ¬¡ç¹ªè£½æ‰€æœ‰ Arduino ç‰¹å¾µåœ–\"\"\"\n",
    "        print(\"\\nğŸ¨ ç¹ªè£½ Arduino ç‰¹å¾µåœ–...\")\n",
    "        \n",
    "        plotted_count = 0\n",
    "        for pid, date_dict in delta_data.items():\n",
    "            for date, delta_df in date_dict.items():\n",
    "                save_path = f\"{self.output_dir}/arduino_features/pineapple_{pid}_{date}_arduino.html\"\n",
    "                result = self.plot_arduino_features(\n",
    "                    delta_df, \n",
    "                    f\"Pineapple {pid} - {date}\", \n",
    "                    save_path\n",
    "                )\n",
    "                if result is not None:\n",
    "                    plotted_count += 1\n",
    "        \n",
    "        if plotted_count > 0:\n",
    "            print(f\"âœ… Arduino ç‰¹å¾µåœ–ç¹ªè£½å®Œæˆï¼å…± {plotted_count} å¼µ\")\n",
    "        else:\n",
    "            print(\"âš ï¸  æœªæ‰¾åˆ°åŒ…å« Arduino ç‰¹å¾µçš„æ•¸æ“š\")\n",
    "\n",
    "# åŸ·è¡Œ Arduino ç‰¹å¾µè¦–è¦ºåŒ–\n",
    "arduino_viz = ArduinoFeatureVisualizer()\n",
    "arduino_viz.plot_all_arduino_features(delta_data)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 77,
   "id": "e008b707-fb75-4abc-a9c6-16751ec6941d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "ğŸ“Š ç¹ªè£½ air åˆ†å¸ƒåœ–...\n",
      "âœ… åˆ†å¸ƒåœ–ç¹ªè£½å®Œæˆï¼\n",
      "\n",
      "ğŸ“Š ç¹ªè£½ pineapple åˆ†å¸ƒåœ–...\n",
      "âœ… åˆ†å¸ƒåœ–ç¹ªè£½å®Œæˆï¼\n",
      "\n",
      "ğŸ¯ è¨ˆç®— air ç©©å®šåº¦åˆ†æ•¸...\n",
      "\n",
      "ğŸ¯ è¨ˆç®— pineapple ç©©å®šåº¦åˆ†æ•¸...\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 9: åˆ†å¸ƒèˆ‡ç©©å®šåº¦åˆ†æ =====\n",
    "\n",
    "class DistributionAnalyzer:\n",
    "    \"\"\"æ„Ÿæ¸¬å™¨åˆ†å¸ƒèˆ‡ç©©å®šåº¦åˆ†æ\"\"\"\n",
    "    \n",
    "    def __init__(self, output_dir='reports/figures'):\n",
    "        self.output_dir = output_dir\n",
    "        self.sensor_cols = ['MQ2_raw', 'MQ3_raw', 'MQ9_raw', 'MQ135_raw', 'TGS2602_raw']\n",
    "    \n",
    "    def plot_sensor_distributions(self, data_dict, data_type='pineapple'):\n",
    "        \"\"\"ç¹ªè£½æ„Ÿæ¸¬å™¨æ•¸å€¼åˆ†å¸ƒ\"\"\"\n",
    "        print(f\"\\nğŸ“Š ç¹ªè£½ {data_type} åˆ†å¸ƒåœ–...\")\n",
    "        \n",
    "        if data_type == 'air':\n",
    "            # Air: æ¯å€‹ key ä¸€å¼µåœ–ï¼ˆkey = é³³æ¢¨ç·¨è™Ÿ_æ—¥æœŸï¼‰\n",
    "            for pid, df in data_dict.items():\n",
    "                self._plot_single_distribution(df, f\"Air_{pid}\", \n",
    "                    f\"{self.output_dir}/distributions/air_{pid}_dist.html\")\n",
    "        else:\n",
    "            # Pineapple: æ¯å€‹ ID+date ä¸€å¼µåœ–\n",
    "            for pid, date_dict in data_dict.items():\n",
    "                for date, df in date_dict.items():\n",
    "                    self._plot_single_distribution(df, f\"Pineapple_{pid}_{date}\",\n",
    "                        f\"{self.output_dir}/distributions/pineapple_{pid}_{date}_dist.html\")\n",
    "        \n",
    "        print(\"âœ… åˆ†å¸ƒåœ–ç¹ªè£½å®Œæˆï¼\")\n",
    "    \n",
    "    def _plot_single_distribution(self, df, title, save_path):\n",
    "        \"\"\"ç¹ªè£½å–®ä¸€æ•¸æ“šé›†çš„åˆ†å¸ƒ\"\"\"\n",
    "        fig = make_subplots(\n",
    "            rows=2, cols=3,\n",
    "            subplot_titles=['MQ2', 'MQ3', 'MQ9', 'MQ135', 'TGS2602', 'Statistics'],\n",
    "            specs=[[{\"type\": \"box\"}, {\"type\": \"box\"}, {\"type\": \"box\"}],\n",
    "                   [{\"type\": \"box\"}, {\"type\": \"box\"}, {\"type\": \"table\"}]]\n",
    "        )\n",
    "        \n",
    "        colors = ['blue', 'red', 'green', 'purple', 'orange']\n",
    "        stats_data = []\n",
    "        \n",
    "        for idx, (col, color) in enumerate(zip(self.sensor_cols, colors)):\n",
    "            if col in df.columns:\n",
    "                row = (idx // 3) + 1\n",
    "                col_pos = (idx % 3) + 1\n",
    "                \n",
    "                # Box plot\n",
    "                fig.add_trace(\n",
    "                    go.Box(\n",
    "                        y=df[col],\n",
    "                        name=col.replace('_raw', ''),\n",
    "                        marker_color=color,\n",
    "                        boxmean='sd',\n",
    "                        showlegend=False\n",
    "                    ),\n",
    "                    row=row, col=col_pos\n",
    "                )\n",
    "                \n",
    "                # è¨ˆç®—çµ±è¨ˆé‡\n",
    "                stats_data.append([\n",
    "                    col.replace('_raw', ''),\n",
    "                    f\"{df[col].mean():.2f}\",\n",
    "                    f\"{df[col].std():.2f}\",\n",
    "                    f\"{df[col].min():.0f}\",\n",
    "                    f\"{df[col].max():.0f}\",\n",
    "                    f\"{df[col].std()/df[col].mean()*100:.2f}%\"\n",
    "                ])\n",
    "        \n",
    "        # çµ±è¨ˆè¡¨æ ¼\n",
    "        fig.add_trace(\n",
    "            go.Table(\n",
    "                header=dict(\n",
    "                    values=['Sensor', 'Mean', 'Std', 'Min', 'Max', 'CV%'],\n",
    "                    fill_color='lightgray',\n",
    "                    align='left'\n",
    "                ),\n",
    "                cells=dict(\n",
    "                    values=list(zip(*stats_data)),\n",
    "                    fill_color='white',\n",
    "                    align='left'\n",
    "                )\n",
    "            ),\n",
    "            row=2, col=3\n",
    "        )\n",
    "        \n",
    "        fig.update_layout(\n",
    "            title_text=f\"Sensor Distributions - {title}\",\n",
    "            height=600,\n",
    "            showlegend=False,\n",
    "            template='plotly_white'\n",
    "        )\n",
    "        \n",
    "        fig.write_html(save_path)\n",
    "    \n",
    "    def calculate_stability_scores(self, data_dict, data_type='pineapple'):\n",
    "        \"\"\"è¨ˆç®—ç©©å®šåº¦åˆ†æ•¸ï¼ˆCV: Coefficient of Variationï¼‰\"\"\"\n",
    "        print(f\"\\nğŸ¯ è¨ˆç®— {data_type} ç©©å®šåº¦åˆ†æ•¸...\")\n",
    "        \n",
    "        stability_report = {}\n",
    "        \n",
    "        if data_type == 'air':\n",
    "            for pid, df in data_dict.items():\n",
    "                stability_report[pid] = self._calc_single_stability(df)\n",
    "        else:\n",
    "            for pid, date_dict in data_dict.items():\n",
    "                stability_report[pid] = {}\n",
    "                for date, df in date_dict.items():\n",
    "                    stability_report[pid][date] = self._calc_single_stability(df)\n",
    "        \n",
    "        return stability_report\n",
    "    \n",
    "    def _calc_single_stability(self, df):\n",
    "        \"\"\"è¨ˆç®—å–®ä¸€æ•¸æ“šé›†çš„ç©©å®šåº¦\"\"\"\n",
    "        stability = {}\n",
    "        \n",
    "        for col in self.sensor_cols:\n",
    "            if col in df.columns:\n",
    "                mean_val = df[col].mean()\n",
    "                std_val = df[col].std()\n",
    "                cv = (std_val / mean_val * 100) if mean_val != 0 else np.inf\n",
    "                \n",
    "                stability[col] = {\n",
    "                    'mean': mean_val,\n",
    "                    'std': std_val,\n",
    "                    'cv_percent': cv,\n",
    "                    'stability_grade': self._grade_stability(cv)\n",
    "                }\n",
    "        \n",
    "        return stability\n",
    "    \n",
    "    def _grade_stability(self, cv):\n",
    "        \"\"\"æ ¹æ“š CV è©•åˆ†ç©©å®šåº¦\"\"\"\n",
    "        if cv < 5:\n",
    "            return 'A (Excellent)'\n",
    "        elif cv < 10:\n",
    "            return 'B (Good)'\n",
    "        elif cv < 20:\n",
    "            return 'C (Fair)'\n",
    "        else:\n",
    "            return 'D (Poor)'\n",
    "\n",
    "# åŸ·è¡Œåˆ†å¸ƒåˆ†æ\n",
    "dist_analyzer = DistributionAnalyzer()\n",
    "dist_analyzer.plot_sensor_distributions(cleaned_air, 'air')\n",
    "dist_analyzer.plot_sensor_distributions(cleaned_pineapple, 'pineapple')\n",
    "\n",
    "# è¨ˆç®—ç©©å®šåº¦\n",
    "air_stability = dist_analyzer.calculate_stability_scores(cleaned_air, 'air')\n",
    "pineapple_stability = dist_analyzer.calculate_stability_scores(cleaned_pineapple, 'pineapple')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 78,
   "id": "8c16e0df-5244-43d1-bd20-e0c8b3620ee5",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "ğŸ”— ç¹ªè£½ç›¸é—œæ€§çŸ©é™£...\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_01_20250201_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_01_20250202_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_01_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_01_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_01_20250205_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_02_20250202_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_02_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_02_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_02_20250205_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_03_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_03_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_03_20250205_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_04_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_04_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_04_20250205_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_05_20250202_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_05_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_05_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_06_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/air_06_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_01_20250201_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_01_20250202_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_01_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_01_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_01_20250205_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_02_20250202_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_02_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_02_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_02_20250205_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_03_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_03_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_03_20250205_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_04_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_04_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_04_20250205_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_05_20250202_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_05_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_05_20250204_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_06_20250202_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_06_20250203_corr.html\n",
      "   ğŸ’¾ å·²å„²å­˜: reports/figures/correlation/pineapple_06_20250204_corr.html\n",
      "âœ… ç›¸é—œæ€§åˆ†æå®Œæˆï¼\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 10: ç›¸é—œæ€§åˆ†æ =====\n",
    "\n",
    "class CorrelationAnalyzer:\n",
    "    \"\"\"æ„Ÿæ¸¬å™¨é–“ç›¸é—œæ€§åˆ†æ\"\"\"\n",
    "    \n",
    "    def __init__(self, output_dir='reports/figures'):\n",
    "        self.output_dir = output_dir\n",
    "        self.sensor_cols = ['MQ2_raw', 'MQ3_raw', 'MQ9_raw', 'MQ135_raw', 'TGS2602_raw']\n",
    "    \n",
    "    def plot_correlation_matrix(self, df, title, save_path):\n",
    "        \"\"\"ç¹ªè£½ç›¸é—œæ€§çŸ©é™£ç†±åŠ›åœ–\"\"\"\n",
    "        # åªé¸æ“‡æ„Ÿæ¸¬å™¨æ¬„ä½\n",
    "        sensor_data = df[self.sensor_cols]\n",
    "        \n",
    "        # è¨ˆç®—ç›¸é—œä¿‚æ•¸\n",
    "        corr_matrix = sensor_data.corr()\n",
    "        \n",
    "        # ç¹ªè£½ç†±åŠ›åœ–\n",
    "        fig = go.Figure(data=go.Heatmap(\n",
    "            z=corr_matrix.values,\n",
    "            x=[col.replace('_raw', '') for col in corr_matrix.columns],\n",
    "            y=[col.replace('_raw', '') for col in corr_matrix.index],\n",
    "            colorscale='RdBu',\n",
    "            zmid=0,\n",
    "            text=corr_matrix.values,\n",
    "            texttemplate='%{text:.2f}',\n",
    "            textfont={\"size\": 12},\n",
    "            colorbar=dict(title=\"Correlation\")\n",
    "        ))\n",
    "        \n",
    "        fig.update_layout(\n",
    "            title=f\"Sensor Correlation Matrix - {title}\",\n",
    "            xaxis_title=\"Sensors\",\n",
    "            yaxis_title=\"Sensors\",\n",
    "            height=500,\n",
    "            width=600,\n",
    "            template='plotly_white'\n",
    "        )\n",
    "        \n",
    "        fig.write_html(save_path)\n",
    "        print(f\"   ğŸ’¾ å·²å„²å­˜: {save_path}\")\n",
    "    \n",
    "    def analyze_all_correlations(self, cleaned_air, cleaned_pineapple):\n",
    "        \"\"\"æ‰¹æ¬¡åˆ†ææ‰€æœ‰ç›¸é—œæ€§\"\"\"\n",
    "        print(\"\\nğŸ”— ç¹ªè£½ç›¸é—œæ€§çŸ©é™£...\")\n",
    "        \n",
    "        # Air\n",
    "        for pid, df in cleaned_air.items():\n",
    "            save_path = f\"{self.output_dir}/correlation/air_{pid}_corr.html\"\n",
    "            self.plot_correlation_matrix(df, f\"Air_{pid}\", save_path)\n",
    "        \n",
    "        # Pineapple\n",
    "        for pid, date_dict in cleaned_pineapple.items():\n",
    "            for date, df in date_dict.items():\n",
    "                save_path = f\"{self.output_dir}/correlation/pineapple_{pid}_{date}_corr.html\"\n",
    "                self.plot_correlation_matrix(df, f\"Pineapple_{pid}_{date}\", save_path)\n",
    "        \n",
    "        print(\"âœ… ç›¸é—œæ€§åˆ†æå®Œæˆï¼\")\n",
    "\n",
    "# åŸ·è¡Œç›¸é—œæ€§åˆ†æ\n",
    "corr_analyzer = CorrelationAnalyzer()\n",
    "corr_analyzer.analyze_all_correlations(cleaned_air, cleaned_pineapple)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 79,
   "id": "badbaac8-5afd-4c20-9d63-3d19b445ea45",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "ğŸ“ ç”Ÿæˆæ‘˜è¦å ±å‘Š...\n",
      "   ğŸ’¾ å·²ç”Ÿæˆ Markdown å ±å‘Š: reports/summary/summary_report.md\n",
      "âœ… å ±å‘Šå·²ç”Ÿæˆ: reports/summary/full_report.json\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 11: ç¶œåˆæ‘˜è¦å ±å‘Š =====\n",
    "\n",
    "class SummaryReportGenerator:\n",
    "    \"\"\"ç”Ÿæˆæ¯é¡†é³³æ¢¨çš„æ‘˜è¦å ±å‘Š\"\"\"\n",
    "    \n",
    "    def __init__(self, output_dir='reports/summary'):\n",
    "        self.output_dir = output_dir\n",
    "    \n",
    "    def generate_full_report(self, cleaned_air, cleaned_pineapple, delta_data, \n",
    "                            cleaning_report, air_stability, pineapple_stability):\n",
    "        \"\"\"ç”Ÿæˆå®Œæ•´çš„æ‘˜è¦å ±å‘Š\"\"\"\n",
    "        print(\"\\nğŸ“ ç”Ÿæˆæ‘˜è¦å ±å‘Š...\")\n",
    "        \n",
    "        report = {\n",
    "            'generation_time': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),\n",
    "            'overview': self._generate_overview(cleaned_air, cleaned_pineapple),\n",
    "            'data_quality': self._generate_quality_report(cleaning_report),\n",
    "            'stability_analysis': self._generate_stability_report(air_stability, pineapple_stability),\n",
    "            'sensor_health': self._generate_sensor_health_summary(cleaning_report),  # ğŸ‘ˆ æ–°å¢\n",
    "            'arduino_features': self._check_arduino_features(delta_data),  # ğŸ‘ˆ æ–°å¢\n",
    "            'recommendations': self._generate_recommendations(cleaned_air, cleaned_pineapple, \n",
    "                                                             pineapple_stability, cleaning_report)\n",
    "        }\n",
    "        \n",
    "        # å„²å­˜ JSON\n",
    "        json_path = f\"{self.output_dir}/full_report.json\"\n",
    "        with open(json_path, 'w', encoding='utf-8') as f:\n",
    "            json.dump(report, f, ensure_ascii=False, indent=2, default=str)\n",
    "        \n",
    "        # ç”Ÿæˆäººé¡å¯è®€çš„å ±å‘Š\n",
    "        self._generate_readable_report(report)\n",
    "        \n",
    "        print(f\"âœ… å ±å‘Šå·²ç”Ÿæˆ: {json_path}\")\n",
    "        return report\n",
    "    \n",
    "    def _generate_overview(self, cleaned_air, cleaned_pineapple):\n",
    "        \"\"\"ç”Ÿæˆç¸½è¦½\"\"\"\n",
    "        total_pineapples = len(cleaned_pineapple)\n",
    "        total_measurements = sum(len(date_dict) for date_dict in cleaned_pineapple.values())\n",
    "        \n",
    "        return {\n",
    "            'total_pineapples': total_pineapples,\n",
    "            'total_measurements': total_measurements,\n",
    "            'pineapple_ids': list(cleaned_pineapple.keys())\n",
    "        }\n",
    "    \n",
    "    def _generate_quality_report(self, cleaning_report):\n",
    "        \"\"\"ç”Ÿæˆæ•¸æ“šå“è³ªå ±å‘Š\"\"\"\n",
    "        quality = {'air': {}, 'pineapple': {}}\n",
    "        \n",
    "        for data_type in ['air', 'pineapple']:\n",
    "            for pid, info in cleaning_report[data_type].items():\n",
    "                if data_type == 'air':\n",
    "                    quality['air'][pid] = {\n",
    "                        'data_retention_rate': f\"{(1 - info['removed_rows']/info['original_rows'])*100:.2f}%\",\n",
    "                        'total_outliers': sum(info['outlier_counts'].values()) if info['outlier_counts'] else 0\n",
    "                    }\n",
    "                else:\n",
    "                    quality['pineapple'][pid] = {}\n",
    "                    for date, date_info in info.items():\n",
    "                        quality['pineapple'][pid][date] = {\n",
    "                            'data_retention_rate': f\"{(1 - date_info['removed_rows']/date_info['original_rows'])*100:.2f}%\",\n",
    "                            'total_outliers': sum(date_info['outlier_counts'].values()) if date_info['outlier_counts'] else 0\n",
    "                        }\n",
    "        \n",
    "        return quality\n",
    "    \n",
    "    def _generate_stability_report(self, air_stability, pineapple_stability):\n",
    "        \"\"\"ç”Ÿæˆç©©å®šåº¦å ±å‘Š\"\"\"\n",
    "        return {\n",
    "            'air': air_stability,\n",
    "            'pineapple': pineapple_stability\n",
    "        }\n",
    "    \n",
    "    def _generate_sensor_health_summary(self, cleaning_report):\n",
    "        \"\"\"ğŸ‘ˆ æ–°å¢ï¼šç”Ÿæˆæ„Ÿæ¸¬å™¨å¥åº·åº¦æ‘˜è¦\"\"\"\n",
    "        health_summary = {'air': {}, 'pineapple': {}}\n",
    "        \n",
    "        for data_type in ['air', 'pineapple']:\n",
    "            for pid, info in cleaning_report[data_type].items():\n",
    "                if data_type == 'air':\n",
    "                    health_summary['air'][pid] = info.get('sensor_health', {})\n",
    "                else:\n",
    "                    health_summary['pineapple'][pid] = {}\n",
    "                    for date, date_info in info.items():\n",
    "                        health_summary['pineapple'][pid][date] = date_info.get('sensor_health', {})\n",
    "        \n",
    "        return health_summary\n",
    "    \n",
    "    def _check_arduino_features(self, delta_data):\n",
    "        \"\"\"ğŸ‘ˆ æ–°å¢ï¼šæª¢æŸ¥ Arduino ç‰¹å¾µå¯ç”¨æ€§\"\"\"\n",
    "        feature_status = {}\n",
    "        \n",
    "        for pid, date_dict in delta_data.items():\n",
    "            feature_status[pid] = {}\n",
    "            for date, delta_df in date_dict.items():\n",
    "                has_features = delta_df.attrs.get('has_arduino_features', False)\n",
    "                feature_status[pid][date] = has_features\n",
    "        \n",
    "        total = sum(len(dates) for dates in feature_status.values())\n",
    "        available = sum(1 for dates in feature_status.values() for has in dates.values() if has)\n",
    "        \n",
    "        return {\n",
    "            'availability': f\"{available}/{total}\",\n",
    "            'percentage': f\"{available/total*100:.1f}%\" if total > 0 else \"0%\",\n",
    "            'details': feature_status\n",
    "        }\n",
    "    \n",
    "    def _generate_recommendations(self, cleaned_air, cleaned_pineapple, \n",
    "                                 pineapple_stability, cleaning_report):\n",
    "        \"\"\"ç”Ÿæˆå»ºè­°ï¼ˆå«æ„Ÿæ¸¬å™¨å¥åº·åº¦ï¼‰\"\"\"\n",
    "        recommendations = []\n",
    "        \n",
    "        # æª¢æŸ¥æ•¸æ“šé‡\n",
    "        total_pineapples = len(cleaned_pineapple)\n",
    "        if total_pineapples < 10:\n",
    "            recommendations.append({\n",
    "                'type': 'data_sufficiency',\n",
    "                'priority': 'high',\n",
    "                'message': f\"ç›®å‰åªæœ‰ {total_pineapples} é¡†é³³æ¢¨ï¼Œå»ºè­°è¿½åŠ è‡³å°‘ 10 é¡†ä»¥ä¸Šä»¥æé«˜æ¨¡å‹å¯é æ€§\"\n",
    "            })\n",
    "        \n",
    "        # æª¢æŸ¥ç©©å®šåº¦\n",
    "        for pid, date_dict in pineapple_stability.items():\n",
    "            for date, stability in date_dict.items():\n",
    "                poor_sensors = [sensor for sensor, info in stability.items() \n",
    "                               if 'Poor' in info['stability_grade']]\n",
    "                if poor_sensors:\n",
    "                    recommendations.append({\n",
    "                        'type': 'sensor_stability',\n",
    "                        'priority': 'medium',\n",
    "                        'pineapple': f\"{pid}_{date}\",\n",
    "                        'message': f\"æ„Ÿæ¸¬å™¨ {poor_sensors} ç©©å®šåº¦è¼ƒå·®ï¼ˆCV > 20%ï¼‰\"\n",
    "                    })\n",
    "        \n",
    "        # ğŸ‘ˆ æ–°å¢ï¼šæª¢æŸ¥æ„Ÿæ¸¬å™¨å¥åº·åº¦\n",
    "        for pid, info in cleaning_report['pineapple'].items():\n",
    "            for date, date_info in info.items():\n",
    "                health = date_info.get('sensor_health', {})\n",
    "                for sensor, sensor_health in health.items():\n",
    "                    if sensor_health['cv_percent'] < 1:\n",
    "                        recommendations.append({\n",
    "                            'type': 'sensor_health',\n",
    "                            'priority': 'low',\n",
    "                            'pineapple': f\"{pid}_{date}\",\n",
    "                            'message': f\"{sensor} è®Šç•°æ¥µå°ï¼ˆCV < 1%ï¼‰ï¼Œå¯èƒ½æœªæ¥è§¸æ°£é«”æˆ–æ„Ÿæ¸¬å™¨æ•…éšœ\"\n",
    "                        })\n",
    "                    \n",
    "                    if sensor_health['significant_jumps'] > 10:\n",
    "                        recommendations.append({\n",
    "                            'type': 'sensor_noise',\n",
    "                            'priority': 'medium',\n",
    "                            'pineapple': f\"{pid}_{date}\",\n",
    "                            'message': f\"{sensor} æœ‰ {sensor_health['significant_jumps']} æ¬¡é¡¯è‘—è·³è®Šï¼Œæª¢æŸ¥è¨Šè™Ÿå“è³ª\"\n",
    "                        })\n",
    "        \n",
    "        return recommendations\n",
    "    \n",
    "    def _generate_readable_report(self, report):\n",
    "        \"\"\"ç”Ÿæˆäººé¡å¯è®€çš„ Markdown å ±å‘Š\"\"\"\n",
    "        md_path = f\"{self.output_dir}/summary_report.md\"\n",
    "        \n",
    "        with open(md_path, 'w', encoding='utf-8') as f:\n",
    "            f.write(\"# é³³æ¢¨æ°£å‘³æ„Ÿæ¸¬å™¨æ•¸æ“šåˆ†æå ±å‘Š\\n\\n\")\n",
    "            f.write(f\"**ç”Ÿæˆæ™‚é–“**: {report['generation_time']}\\n\\n\")\n",
    "            \n",
    "            f.write(\"## ğŸ“Š æ•¸æ“šç¸½è¦½\\n\\n\")\n",
    "            f.write(f\"- é³³æ¢¨ç¸½æ•¸: {report['overview']['total_pineapples']} é¡†\\n\")\n",
    "            f.write(f\"- æ¸¬é‡æ¬¡æ•¸: {report['overview']['total_measurements']} æ¬¡\\n\")\n",
    "            f.write(f\"- é³³æ¢¨ç·¨è™Ÿ: {', '.join(report['overview']['pineapple_ids'])}\\n\\n\")\n",
    "            \n",
    "            # ğŸ‘ˆ æ–°å¢ï¼šArduino ç‰¹å¾µå¯ç”¨æ€§\n",
    "            f.write(\"## ğŸ¨ Arduino é è™•ç†ç‰¹å¾µ\\n\\n\")\n",
    "            f.write(f\"- å¯ç”¨æ€§: {report['arduino_features']['availability']} ({report['arduino_features']['percentage']})\\n\")\n",
    "            if report['arduino_features']['percentage'] == '100.0%':\n",
    "                f.write(\"- âœ… æ‰€æœ‰æ•¸æ“šé›†éƒ½åŒ…å«å®Œæ•´çš„ Arduino ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰\\n\\n\")\n",
    "            else:\n",
    "                f.write(\"- âš ï¸  éƒ¨åˆ†æ•¸æ“šé›†ç¼ºå°‘ Arduino ç‰¹å¾µ\\n\\n\")\n",
    "            \n",
    "            f.write(\"## âœ… æ•¸æ“šå“è³ªè©•ä¼°\\n\\n\")\n",
    "            f.write(\"### Air Baseline\\n\\n\")\n",
    "            for pid, quality in report['data_quality']['air'].items():\n",
    "                f.write(f\"- **Air_{pid}**: ä¿ç•™ç‡ {quality['data_retention_rate']}, \"\n",
    "                       f\"ç•°å¸¸å€¼ {quality['total_outliers']} å€‹\\n\")\n",
    "            \n",
    "            f.write(\"\\n### Pineapple æ¸¬é‡\\n\\n\")\n",
    "            for pid, dates in report['data_quality']['pineapple'].items():\n",
    "                for date, quality in dates.items():\n",
    "                    f.write(f\"- **Pineapple_{pid}_{date}**: ä¿ç•™ç‡ {quality['data_retention_rate']}, \"\n",
    "                           f\"ç•°å¸¸å€¼ {quality['total_outliers']} å€‹\\n\")\n",
    "            \n",
    "            f.write(\"\\n## ğŸ’¡ å»ºè­°äº‹é …\\n\\n\")\n",
    "            if report['recommendations']:\n",
    "                # æŒ‰å„ªå…ˆç´šåˆ†çµ„\n",
    "                high_priority = [r for r in report['recommendations'] if r['priority'] == 'high']\n",
    "                medium_priority = [r for r in report['recommendations'] if r['priority'] == 'medium']\n",
    "                low_priority = [r for r in report['recommendations'] if r['priority'] == 'low']\n",
    "                \n",
    "                if high_priority:\n",
    "                    f.write(\"### ğŸ”´ é«˜å„ªå…ˆç´š\\n\\n\")\n",
    "                    for rec in high_priority:\n",
    "                        f.write(f\"- **{rec['type']}**: {rec['message']}\\n\")\n",
    "                    f.write(\"\\n\")\n",
    "                \n",
    "                if medium_priority:\n",
    "                    f.write(\"### ğŸŸ¡ ä¸­å„ªå…ˆç´š\\n\\n\")\n",
    "                    for rec in medium_priority:\n",
    "                        pineapple = rec.get('pineapple', '')\n",
    "                        f.write(f\"- **{rec['type']}** ({pineapple}): {rec['message']}\\n\")\n",
    "                    f.write(\"\\n\")\n",
    "                \n",
    "                if low_priority:\n",
    "                    f.write(\"### ğŸŸ¢ ä½å„ªå…ˆç´š\\n\\n\")\n",
    "                    for rec in low_priority:\n",
    "                        pineapple = rec.get('pineapple', '')\n",
    "                        f.write(f\"- **{rec['type']}** ({pineapple}): {rec['message']}\\n\")\n",
    "                    f.write(\"\\n\")\n",
    "            else:\n",
    "                f.write(\"âœ… æ•¸æ“šå“è³ªè‰¯å¥½ï¼Œç„¡éœ€é¡å¤–è™•ç†\\n\\n\")\n",
    "        \n",
    "        print(f\"   ğŸ’¾ å·²ç”Ÿæˆ Markdown å ±å‘Š: {md_path}\")\n",
    "\n",
    "# ç”Ÿæˆå ±å‘Š\n",
    "report_gen = SummaryReportGenerator()\n",
    "final_report = report_gen.generate_full_report(\n",
    "    cleaned_air, cleaned_pineapple, delta_data,\n",
    "    cleaning_report, air_stability, pineapple_stability\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 80,
   "id": "d6d649ff-8cbf-43c8-a22b-5d5ac77cc03d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "============================================================\n",
      "ğŸ‰ Step 1: è‡ªå‹•åŒ–è³‡æ–™æ¸…æ´—èˆ‡åˆæ­¥åˆ†æ (EDA) å®Œæˆï¼\n",
      "============================================================\n",
      "\n",
      "ğŸ“ å·²ç”Ÿæˆçš„æª”æ¡ˆï¼š\n",
      "   ğŸ“Š Raw æ™‚åºåœ–: reports/figures/raw_timeseries/\n",
      "   ğŸ“‰ Delta æ™‚åºåœ–: reports/figures/delta_timeseries/\n",
      "   ğŸ¨ Arduino ç‰¹å¾µåœ–: reports/figures/arduino_features/\n",
      "   ğŸ“ˆ åˆ†å¸ƒåœ–: reports/figures/distributions/\n",
      "   ğŸ”— ç›¸é—œæ€§çŸ©é™£: reports/figures/correlation/\n",
      "   ğŸ“ æ‘˜è¦å ±å‘Š: reports/summary/\n",
      "\n",
      "ğŸ’¡ é—œéµç™¼ç¾ï¼š\n",
      "   â€¢ é³³æ¢¨ç¸½æ•¸: 6 é¡†\n",
      "   â€¢ æ¸¬é‡æ¬¡æ•¸: 21 æ¬¡\n",
      "   â€¢ Arduino ç‰¹å¾µå¯ç”¨æ€§: 100.0%\n",
      "\n",
      "âš ï¸  å»ºè­°äº‹é …ï¼š\n",
      "   [é«˜] ç›®å‰åªæœ‰ 6 é¡†é³³æ¢¨ï¼Œå»ºè­°è¿½åŠ è‡³å°‘ 10 é¡†ä»¥ä¸Šä»¥æé«˜æ¨¡å‹å¯é æ€§\n",
      "   [ä¸­] MQ2_raw æœ‰ 48 æ¬¡é¡¯è‘—è·³è®Šï¼Œæª¢æŸ¥è¨Šè™Ÿå“è³ª\n",
      "   [ä¸­] MQ9_raw æœ‰ 14 æ¬¡é¡¯è‘—è·³è®Šï¼Œæª¢æŸ¥è¨Šè™Ÿå“è³ª\n",
      "   ... ç­‰å…± 72 é …å»ºè­°ï¼ˆè©³è¦‹å ±å‘Šï¼‰\n",
      "\n",
      "âœ… æ•¸æ“šå¯ç”¨æ€§è©•ä¼°ï¼š\n",
      "   âš ï¸  å»ºè­°è¿½åŠ æ¸¬è©¦ï¼ˆStep 2ï¼‰ï¼Œç›®æ¨™è‡³å°‘ 10 é¡†é³³æ¢¨\n",
      "\n",
      "ğŸš€ ä¸‹ä¸€æ­¥ (Step 2)ï¼š\n",
      "   1. æª¢è¦– reports/ è³‡æ–™å¤¾ä¸­çš„æ‰€æœ‰åœ–è¡¨\n",
      "   2. ç‰¹åˆ¥æ³¨æ„ Arduino ç‰¹å¾µåœ–ï¼ˆarduino_features/ï¼‰\n",
      "   3. èˆ‡å°çµ„è¨è«–æ•¸æ“šå“è³ªèˆ‡æ¨£æœ¬æ•¸é‡\n",
      "   4. æ±ºå®šæ˜¯å¦éœ€è¦è¿½åŠ æ¸¬è©¦\n",
      "   5. ç¢ºèªå¾Œé€²å…¥ Step 3: Change-point detection & Clustering\n",
      "\n",
      "ğŸ“Œ æé†’ï¼š\n",
      "   â€¢ Arduino å·²é è™•ç†çš„ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰å·²å®Œæ•´ä¿ç•™\n",
      "   â€¢ æ„Ÿæ¸¬å™¨å¥åº·åº¦å ±å‘Šå·²æ•´åˆåˆ°æ‘˜è¦ä¸­\n",
      "   â€¢ æ‰€æœ‰è¦–è¦ºåŒ–åœ–è¡¨éƒ½æ˜¯äº’å‹•å¼ HTMLï¼Œå¯ç”¨ç€è¦½å™¨é–‹å•Ÿ\n",
      "\n",
      "============================================================\n"
     ]
    }
   ],
   "source": [
    "# ===== Cell 12: æœ€çµ‚ç¸½çµ =====\n",
    "\n",
    "print(\"\\n\" + \"=\"*60)\n",
    "print(\"ğŸ‰ Step 1: è‡ªå‹•åŒ–è³‡æ–™æ¸…æ´—èˆ‡åˆæ­¥åˆ†æ (EDA) å®Œæˆï¼\")\n",
    "print(\"=\"*60)\n",
    "\n",
    "print(\"\\nğŸ“ å·²ç”Ÿæˆçš„æª”æ¡ˆï¼š\")\n",
    "print(\"   ğŸ“Š Raw æ™‚åºåœ–: reports/figures/raw_timeseries/\")\n",
    "print(\"   ğŸ“‰ Delta æ™‚åºåœ–: reports/figures/delta_timeseries/\")\n",
    "print(\"   ğŸ¨ Arduino ç‰¹å¾µåœ–: reports/figures/arduino_features/\")\n",
    "print(\"   ğŸ“ˆ åˆ†å¸ƒåœ–: reports/figures/distributions/\")\n",
    "print(\"   ğŸ”— ç›¸é—œæ€§çŸ©é™£: reports/figures/correlation/\")\n",
    "print(\"   ğŸ“ æ‘˜è¦å ±å‘Š: reports/summary/\")\n",
    "\n",
    "print(\"\\nğŸ’¡ é—œéµç™¼ç¾ï¼š\")\n",
    "print(f\"   â€¢ é³³æ¢¨ç¸½æ•¸: {final_report['overview']['total_pineapples']} é¡†\")\n",
    "print(f\"   â€¢ æ¸¬é‡æ¬¡æ•¸: {final_report['overview']['total_measurements']} æ¬¡\")\n",
    "print(f\"   â€¢ Arduino ç‰¹å¾µå¯ç”¨æ€§: {final_report['arduino_features']['percentage']}\")\n",
    "\n",
    "if final_report['recommendations']:\n",
    "    print(\"\\nâš ï¸  å»ºè­°äº‹é …ï¼š\")\n",
    "    high_priority = [r for r in final_report['recommendations'] if r['priority'] == 'high']\n",
    "    medium_priority = [r for r in final_report['recommendations'] if r['priority'] == 'medium']\n",
    "    \n",
    "    for rec in high_priority[:3]:  # åªé¡¯ç¤ºå‰3å€‹é«˜å„ªå…ˆç´š\n",
    "        print(f\"   [é«˜] {rec['message']}\")\n",
    "    \n",
    "    for rec in medium_priority[:3]:  # åªé¡¯ç¤ºå‰3å€‹ä¸­å„ªå…ˆç´š\n",
    "        print(f\"   [ä¸­] {rec['message']}\")\n",
    "    \n",
    "    if len(final_report['recommendations']) > 6:\n",
    "        print(f\"   ... ç­‰å…± {len(final_report['recommendations'])} é …å»ºè­°ï¼ˆè©³è¦‹å ±å‘Šï¼‰\")\n",
    "\n",
    "print(\"\\nâœ… æ•¸æ“šå¯ç”¨æ€§è©•ä¼°ï¼š\")\n",
    "if final_report['overview']['total_pineapples'] >= 10:\n",
    "    print(\"   âœ“ æ•¸æ“šé‡å……è¶³ï¼Œå¯é€²å…¥ Step 3ï¼ˆæˆç†Ÿéšæ®µå®šç¾©ï¼‰\")\n",
    "else:\n",
    "    print(\"   âš ï¸  å»ºè­°è¿½åŠ æ¸¬è©¦ï¼ˆStep 2ï¼‰ï¼Œç›®æ¨™è‡³å°‘ 10 é¡†é³³æ¢¨\")\n",
    "\n",
    "print(\"\\nğŸš€ ä¸‹ä¸€æ­¥ (Step 2)ï¼š\")\n",
    "print(\"   1. æª¢è¦– reports/ è³‡æ–™å¤¾ä¸­çš„æ‰€æœ‰åœ–è¡¨\")\n",
    "print(\"   2. ç‰¹åˆ¥æ³¨æ„ Arduino ç‰¹å¾µåœ–ï¼ˆarduino_features/ï¼‰\")\n",
    "print(\"   3. èˆ‡å°çµ„è¨è«–æ•¸æ“šå“è³ªèˆ‡æ¨£æœ¬æ•¸é‡\")\n",
    "print(\"   4. æ±ºå®šæ˜¯å¦éœ€è¦è¿½åŠ æ¸¬è©¦\")\n",
    "print(\"   5. ç¢ºèªå¾Œé€²å…¥ Step 3: Change-point detection & Clustering\")\n",
    "\n",
    "print(\"\\nğŸ“Œ æé†’ï¼š\")\n",
    "print(\"   â€¢ Arduino å·²é è™•ç†çš„ç‰¹å¾µï¼ˆlog ratio, delta, MA5ï¼‰å·²å®Œæ•´ä¿ç•™\")\n",
    "print(\"   â€¢ æ„Ÿæ¸¬å™¨å¥åº·åº¦å ±å‘Šå·²æ•´åˆåˆ°æ‘˜è¦ä¸­\")\n",
    "print(\"   â€¢ æ‰€æœ‰è¦–è¦ºåŒ–åœ–è¡¨éƒ½æ˜¯äº’å‹•å¼ HTMLï¼Œå¯ç”¨ç€è¦½å™¨é–‹å•Ÿ\")\n",
    "\n",
    "print(\"\\n\" + \"=\"*60)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "de5b53e9-0a5c-4069-8976-50e0218b81ed",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "id": "38faede3",
   "metadata": {},
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
